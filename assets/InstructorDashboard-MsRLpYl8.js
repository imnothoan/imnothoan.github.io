import{c as V,u as te,a as Y,b as _e,r as p,s as I,B as u,j as e,T as ve,R as we,A as Se}from"./index-Cm7afGFb.js";import{F as Ce,L as ke}from"./LanguageSwitcher-D97HBjSZ.js";import{G as Ee,S as Te,L as Me,P as Pe,B as W,U as ee,X as de,a as ae}from"./ProfileSettings-CfpxUYtb.js";import{L as B,U as De,A as $e,m as le}from"./proxy-lcE3u9n4.js";import{a as re,b as Ie,S as ne}from"./FaceVerification-BFNwBp5q.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=V("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=V("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=V("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=V("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=V("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=V("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=V("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=V("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),qe=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;function Le(t){return qe.test(t)}function Re(t){return/^[A-Za-z0-9-_]+$/.test(t)}function Z(t){return t?new Date(t).toISOString():null}function ce(t){if(!t)return"";const w=new Date(t),o=w.getFullYear(),s=String(w.getMonth()+1).padStart(2,"0"),a=String(w.getDate()).padStart(2,"0"),h=String(w.getHours()).padStart(2,"0"),d=String(w.getMinutes()).padStart(2,"0");return`${o}-${s}-${a}T${h}:${d}`}function G({isOpen:t,onClose:w,title:o,children:s}){return t?e.jsx($e,{children:e.jsx(le.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:w,children:e.jsxs(le.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-paper rounded-2xl shadow-soft max-w-2xl w-full max-h-[90vh] overflow-hidden",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold text-text-main",children:o}),e.jsx("button",{onClick:w,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(de,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-150px)]",children:s})]})})}):null}function Ue({classId:t,onClose:w,onSuccess:o}){const{user:s}=te(),{t:a}=Y(),[h,d]=p.useState(!1),[r,k]=p.useState({title:"",description:"",duration_minutes:60,start_time:"",end_time:"",is_shuffled:!0,show_result_immediately:!1,allow_review:!1,passing_score:50,max_attempts:1,require_camera:!0,require_fullscreen:!0,max_tab_violations:3,max_fullscreen_violations:3}),f=x=>{const{name:y,value:b,type:P,checked:S}=x.target;k(i=>({...i,[y]:P==="checkbox"?S:b}))},g=async x=>{if(x.preventDefault(),h)return;const y=r.title.trim();if(!y){u.error(a("validation.enterExamTitle"));return}if(y.length>200){u.error(a("validation.examTitleTooLong"));return}if(!r.start_time||!r.end_time){u.error(a("validation.selectTime"));return}const b=new Date(r.start_time);if(new Date(r.end_time)<=b){u.error(a("validation.endAfterStart"));return}const S=parseInt(r.duration_minutes);if(isNaN(S)||S<5||S>480){u.error(a("validation.durationRange"));return}d(!0);const i=async(c=0)=>{var l,N,$,m,M,O;try{const j=new Promise((Q,L)=>setTimeout(()=>L(new Error("REQUEST_TIMEOUT")),3e4)),A=I.from("exams").insert({title:y,description:((l=r.description)==null?void 0:l.trim())||null,duration_minutes:S,start_time:Z(r.start_time),end_time:Z(r.end_time),is_shuffled:r.is_shuffled,show_result_immediately:r.show_result_immediately,allow_review:r.allow_review,passing_score:parseFloat(r.passing_score)||50,max_attempts:parseInt(r.max_attempts)||1,require_camera:r.require_camera,require_fullscreen:r.require_fullscreen,max_tab_violations:parseInt(r.max_tab_violations)||3,max_fullscreen_violations:parseInt(r.max_fullscreen_violations)||3,class_id:t,created_by:s.id,status:"draft"}).select().single(),{data:_,error:D}=await Promise.race([A,j]);if(D)throw D;u.success(a("exam.createSuccess")),o==null||o(_),w()}catch(j){if(console.error("Create exam error:",j),console.error("Error details:",{code:j.code,message:j.message,details:j.details,hint:j.hint}),j.message==="REQUEST_TIMEOUT"){if(c<3)return u.info(a("error.retrying",{attempt:c+1,max:3})),await new Promise(A=>setTimeout(A,1e3)),i(c+1);u.error(a("error.timeout"))}else j.code==="42501"||(N=j.message)!=null&&N.includes("permission")||($=j.message)!=null&&$.includes("denied")?u.error(a("error.permission")):(m=j.message)!=null&&m.includes("network")||(M=j.message)!=null&&M.includes("fetch")||(O=j.message)!=null&&O.includes("Failed to fetch")?u.error(a("error.network")):j.code==="23503"?u.error(a("exam.createError")):u.error(a("exam.createError"))}finally{d(!1)}};await i(0)};return e.jsxs("form",{onSubmit:g,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center space-x-2",children:[e.jsx(W,{className:"w-5 h-5 text-primary"}),e.jsx("span",{children:a("exam.basicInfo")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[a("exam.title")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",name:"title",value:r.title,onChange:f,placeholder:a("exam.titlePlaceholder"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a("exam.description")}),e.jsx("textarea",{name:"description",value:r.description,onChange:f,placeholder:a("exam.descriptionPlaceholder"),rows:3,className:"input resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a("exam.durationMinutes")}),e.jsx("input",{type:"number",name:"duration_minutes",value:r.duration_minutes,onChange:f,min:5,max:300,className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a("exam.passingScore")}),e.jsx("input",{type:"number",name:"passing_score",value:r.passing_score,onChange:f,min:0,max:100,className:"input"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center space-x-2",children:[e.jsx(re,{className:"w-5 h-5 text-primary"}),e.jsx("span",{children:a("exam.timeSettings")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[a("exam.startTime")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"datetime-local",name:"start_time",value:r.start_time,onChange:f,className:"input"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[a("exam.endTime")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"datetime-local",name:"end_time",value:r.end_time,onChange:f,className:"input"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center space-x-2",children:[e.jsx(ne,{className:"w-5 h-5 text-primary"}),e.jsx("span",{children:a("exam.antiCheatSettings")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors",children:[e.jsx("input",{type:"checkbox",name:"require_camera",checked:r.require_camera,onChange:f,className:"w-5 h-5 text-primary rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:a("exam.requireCamera")})]}),e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors",children:[e.jsx("input",{type:"checkbox",name:"require_fullscreen",checked:r.require_fullscreen,onChange:f,className:"w-5 h-5 text-primary rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:a("exam.requireFullscreen")})]}),e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors",children:[e.jsx("input",{type:"checkbox",name:"is_shuffled",checked:r.is_shuffled,onChange:f,className:"w-5 h-5 text-primary rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:a("exam.shuffleQuestions")})]}),e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors",children:[e.jsx("input",{type:"checkbox",name:"show_result_immediately",checked:r.show_result_immediately,onChange:f,className:"w-5 h-5 text-primary rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:a("exam.showResultImmediately")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a("exam.maxTabViolations")}),e.jsx("input",{type:"number",name:"max_tab_violations",value:r.max_tab_violations,onChange:f,min:0,max:10,className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a("exam.maxFullscreenViolations")}),e.jsx("input",{type:"number",name:"max_fullscreen_violations",value:r.max_fullscreen_violations,onChange:f,min:0,max:10,className:"input"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:w,className:"btn-secondary",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:h,className:"btn-primary",children:[h?e.jsx(B,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(ae,{className:"w-5 h-5 mr-2"}),a("exam.create")]})]})]})}function Qe({exam:t,onClose:w,onSuccess:o}){const{t:s}=Y(),[a,h]=p.useState(!1),[d,r]=p.useState({title:(t==null?void 0:t.title)||"",description:(t==null?void 0:t.description)||"",duration_minutes:(t==null?void 0:t.duration_minutes)||60,start_time:ce(t==null?void 0:t.start_time)||"",end_time:ce(t==null?void 0:t.end_time)||"",is_shuffled:(t==null?void 0:t.is_shuffled)??!0,show_result_immediately:(t==null?void 0:t.show_result_immediately)??!1,allow_review:(t==null?void 0:t.allow_review)??!1,passing_score:(t==null?void 0:t.passing_score)||50,max_attempts:(t==null?void 0:t.max_attempts)||1,require_camera:(t==null?void 0:t.require_camera)??!0,require_fullscreen:(t==null?void 0:t.require_fullscreen)??!0,max_tab_violations:(t==null?void 0:t.max_tab_violations)||3,max_fullscreen_violations:(t==null?void 0:t.max_fullscreen_violations)||3}),k=g=>{const{name:x,value:y,type:b,checked:P}=g.target;r(S=>({...S,[x]:b==="checkbox"?P:y}))},f=async g=>{var P,S;g.preventDefault();const x=(P=d.title)==null?void 0:P.trim();if(!x){u.error(s("validation.examTitleRequired"));return}if(!d.start_time||!d.end_time){u.error(s("validation.selectTime"));return}const y=new Date(d.start_time);if(new Date(d.end_time)<=y){u.error(s("validation.endAfterStart"));return}h(!0);try{const{data:i,error:c}=await I.from("exams").update({title:x,description:((S=d.description)==null?void 0:S.trim())||null,duration_minutes:parseInt(d.duration_minutes)||60,start_time:Z(d.start_time),end_time:Z(d.end_time),is_shuffled:d.is_shuffled,show_result_immediately:d.show_result_immediately,allow_review:d.allow_review,passing_score:parseFloat(d.passing_score)||50,max_attempts:parseInt(d.max_attempts)||1,require_camera:d.require_camera,require_fullscreen:d.require_fullscreen,max_tab_violations:parseInt(d.max_tab_violations)||3,max_fullscreen_violations:parseInt(d.max_fullscreen_violations)||3}).eq("id",t.id).select().single();if(c)throw c;u.success(s("exam.updateSuccess")),o==null||o(i),w()}catch(i){console.error("Update exam error:",i),u.error(s("exam.updateError"))}finally{h(!1)}};return e.jsxs("form",{onSubmit:f,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center space-x-2",children:[e.jsx(W,{className:"w-5 h-5 text-primary"}),e.jsx("span",{children:s("exam.basicInfo")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("exam.title")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",name:"title",value:d.title,onChange:k,placeholder:s("exam.titlePlaceholder"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("exam.description")}),e.jsx("textarea",{name:"description",value:d.description,onChange:k,placeholder:s("exam.descriptionPlaceholder"),rows:3,className:"input resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("exam.durationMinutes")}),e.jsx("input",{type:"number",name:"duration_minutes",value:d.duration_minutes,onChange:k,min:5,max:300,className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("exam.passingScore")}),e.jsx("input",{type:"number",name:"passing_score",value:d.passing_score,onChange:k,min:0,max:100,className:"input"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center space-x-2",children:[e.jsx(re,{className:"w-5 h-5 text-primary"}),e.jsx("span",{children:s("exam.timeSettings")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("exam.startTime")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"datetime-local",name:"start_time",value:d.start_time,onChange:k,className:"input"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("exam.endTime")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"datetime-local",name:"end_time",value:d.end_time,onChange:k,className:"input"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center space-x-2",children:[e.jsx(ne,{className:"w-5 h-5 text-primary"}),e.jsx("span",{children:s("exam.antiCheatSettings")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors",children:[e.jsx("input",{type:"checkbox",name:"require_camera",checked:d.require_camera,onChange:k,className:"w-5 h-5 text-primary rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:s("exam.requireCamera")})]}),e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors",children:[e.jsx("input",{type:"checkbox",name:"require_fullscreen",checked:d.require_fullscreen,onChange:k,className:"w-5 h-5 text-primary rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:s("exam.requireFullscreen")})]}),e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors",children:[e.jsx("input",{type:"checkbox",name:"is_shuffled",checked:d.is_shuffled,onChange:k,className:"w-5 h-5 text-primary rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:s("exam.shuffleQuestions")})]}),e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors",children:[e.jsx("input",{type:"checkbox",name:"show_result_immediately",checked:d.show_result_immediately,onChange:k,className:"w-5 h-5 text-primary rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:s("exam.showResultImmediately")})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:w,className:"btn-secondary",children:s("common.cancel")}),e.jsxs("button",{type:"submit",disabled:a,className:"btn-primary",children:[a?e.jsx(B,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(ae,{className:"w-5 h-5 mr-2"}),s("exam.update")]})]})]})}function ze({classId:t,onClose:w,onSuccess:o}){const{t:s}=Y(),[a,h]=p.useState(!1),[d,r]=p.useState(""),[k,f]=p.useState(""),[g,x]=p.useState("single"),y=async i=>{try{const{data:c,error:v}=await I.rpc("add_student_to_class",{p_class_id:t,p_student_email:i.toLowerCase().trim()});return v?(console.error("RPC add_student_to_class error:",v),{success:!1,error:"rpc_failed"}):c&&c.success?{success:!0,student_id:c.student_id}:{success:!1,error:(c==null?void 0:c.error)||"unknown_error"}}catch(c){return console.error("RPC call exception:",c),{success:!1,error:"rpc_exception"}}},b=async i=>{const{data:c,error:v}=await I.from("profiles").select("id, role").eq("email",i.toLowerCase().trim()).single();if(v)return v.code==="PGRST116"?{success:!1,error:"student_not_found"}:(console.error("Profile lookup error:",v),{success:!1,error:"lookup_failed"});if(!c)return{success:!1,error:"student_not_found"};const{error:E}=await I.from("enrollments").insert({class_id:t,student_id:c.id,status:"active"});return E?E.code==="23505"?{success:!1,error:"already_enrolled"}:(console.error("Enroll error:",E),{success:!1,error:"enroll_failed"}):{success:!0}},P=async i=>{const c=await y(i);return c.success?c:c.error==="rpc_failed"||c.error==="rpc_exception"?(console.log("RPC not available, falling back to direct method"),b(i)):c},S=async i=>{if(i.preventDefault(),a)return;const c=g==="single"?[d.trim()]:k.split(`
`).map(m=>m.trim()).filter(m=>m);if(c.length===0){u.error(s("validation.enterStudentEmail"));return}if(c.length>100){u.error(s("validation.maxEmails"));return}const v=c.filter(m=>!Le(m));if(v.length>0){u.error(s("validation.invalidEmails",{emails:v.slice(0,3).join(", ")+(v.length>3?"...":"")}));return}h(!0);let E=0,l=0;const N=[],$=15e3;for(const m of c)try{const M=new Promise((A,_)=>setTimeout(()=>_(new Error("REQUEST_TIMEOUT")),$)),O=P(m),j=await Promise.race([O,M]);if(j.success)E++;else{const A=j.error;A==="student_not_found"?N.push(`${m}: ${s("student.notRegistered")}`):A==="already_enrolled"?N.push(`${m}: ${s("student.alreadyInClass")}`):A==="class_not_found"?N.push(`${m}: ${s("error.classNotFound")}`):A==="not_authorized"?N.push(`${m}: ${s("error.permission")}`):N.push(`${m}: ${s("student.addError")}`),l++}}catch(M){console.error("Add student error:",M),M.message==="REQUEST_TIMEOUT"?N.push(`${m}: ${s("error.timeout")}`):N.push(`${m}: ${s("error.network")}`),l++}if(h(!1),E>0&&(u.success(s("student.addSuccess",{count:E})),o==null||o()),l>0){const m=N.slice(0,3).join(`
`),M=N.length>3?`
... ${N.length-3} ${s("common.more")}`:"";u.warning(`${m}${M}`,{autoClose:8e3})}E>0&&l===0&&w()};return e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{className:"flex space-x-2 p-1 bg-gray-100 rounded-lg",children:[e.jsx("button",{type:"button",onClick:()=>x("single"),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${g==="single"?"bg-white shadow text-primary":"text-gray-600 hover:text-gray-900"}`,children:s("student.addSingle")}),e.jsx("button",{type:"button",onClick:()=>x("bulk"),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${g==="bulk"?"bg-white shadow text-primary":"text-gray-600 hover:text-gray-900"}`,children:s("student.addBulk")})]}),g==="single"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("student.email")}),e.jsx("input",{type:"email",value:d,onChange:i=>r(i.target.value),placeholder:"student@example.com",className:"input"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s("student.emailNote")})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("student.emailList")}),e.jsx("textarea",{value:k,onChange:i=>f(i.target.value),placeholder:`student1@example.com
student2@example.com
student3@example.com`,rows:8,className:"input resize-none font-mono text-sm"})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:w,className:"btn-secondary",children:s("common.cancel")}),e.jsxs("button",{type:"submit",disabled:a,className:"btn-primary",children:[a?e.jsx(B,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(U,{className:"w-5 h-5 mr-2"}),s("student.add")]})]})]})}function Ve({examId:t,examTitle:w,onClose:o}){const{t:s}=Y(),[a,h]=p.useState(!0),[d,r]=p.useState(!1),[k,f]=p.useState([]),[g,x]=p.useState(null),[y,b]=p.useState(!1);p.useEffect(()=>{(async()=>{try{const{data:c,error:v}=await I.from("questions").select("*").eq("exam_id",t).order("order_index");if(v)throw v;f(c||[])}catch(c){console.error("Load questions error:",c),u.error(s("error.general"))}finally{h(!1)}})()},[t,s]);const P=async i=>{if(window.confirm(s("question.deleteConfirm")))try{const{error:c}=await I.from("questions").delete().eq("id",i);if(c)throw c;f(v=>v.filter(E=>E.id!==i)),u.success(s("common.success"))}catch{u.error(s("error.general"))}},S=async i=>{r(!0);try{if(g){const{error:c}=await I.from("questions").update({question_text:i.question_text,question_type:i.question_type,options:i.options,correct_answer:i.correct_answer,points:i.points,difficulty:i.difficulty,explanation:i.explanation}).eq("id",g.id);if(c)throw c;f(v=>v.map(E=>E.id===g.id?{...E,...i}:E))}else{const{data:c,error:v}=await I.from("questions").insert({exam_id:t,question_text:i.question_text,question_type:i.question_type,options:i.options,correct_answer:i.correct_answer,points:i.points,difficulty:i.difficulty,explanation:i.explanation,order_index:k.length}).select().single();if(v)throw v;f(E=>[...E,c])}u.success(s("question.saveSuccess")),x(null),b(!1)}catch(c){console.error("Save question error:",c),u.error(s("question.saveError"))}finally{r(!1)}};return a?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsx(B,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:w}),e.jsx("p",{className:"text-sm text-gray-500",children:s("exam.questionsCount",{count:k.length})})]}),e.jsxs("button",{onClick:()=>{x(null),b(!0)},className:"btn-primary",children:[e.jsx(U,{className:"w-5 h-5 mr-2"}),s("question.add")]})]}),(y||g)&&e.jsx(Be,{question:g,onSave:S,onCancel:()=>{x(null),b(!1)},saving:d}),k.length>0?e.jsx("div",{className:"space-y-3",children:k.map((i,c)=>e.jsx("div",{className:"p-4 border border-gray-200 rounded-lg hover:border-primary-300 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("span",{className:"w-6 h-6 bg-primary-100 text-primary text-sm font-bold rounded-full flex items-center justify-center",children:c+1}),e.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-100 text-gray-600 rounded",children:i.question_type==="multiple_choice"?s("question.multipleChoice"):i.question_type==="true_false"?s("question.trueFalse"):i.question_type==="short_answer"?s("question.shortAnswer"):s("question.essay")}),e.jsxs("span",{className:"text-xs text-gray-500",children:[i.points," ",s("exam.points")]})]}),e.jsx("p",{className:"text-gray-800",children:i.question_text}),i.options&&i.options.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:i.options.map((v,E)=>e.jsxs("div",{className:`text-sm px-2 py-1 rounded ${JSON.stringify(i.correct_answer)===JSON.stringify(v.id)?"bg-success-50 text-success-700":"text-gray-600"}`,children:[v.id,". ",v.text,JSON.stringify(i.correct_answer)===JSON.stringify(v.id)&&" âœ“"]},v.id||E))})]}),e.jsxs("div",{className:"flex items-center space-x-1 ml-4",children:[e.jsx("button",{onClick:()=>{x(i),b(!1)},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:s("question.edit"),children:e.jsx(me,{className:"w-4 h-4 text-gray-500"})}),e.jsx("button",{onClick:()=>P(i.id),className:"p-2 hover:bg-danger-50 rounded-lg transition-colors",title:s("question.delete"),children:e.jsx(xe,{className:"w-4 h-4 text-danger"})})]})]})},i.id))}):!y&&e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-xl",children:[e.jsx(K,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-gray-500 mb-2",children:s("question.noQuestions")}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:s("question.noQuestionsDesc")}),e.jsxs("button",{onClick:()=>{x(null),b(!0)},className:"btn-primary",children:[e.jsx(U,{className:"w-5 h-5 mr-2"}),s("question.add")]})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-200",children:e.jsx("button",{onClick:o,className:"btn-secondary",children:s("common.close")})})]})}const oe=2,Ye=6;function Be({question:t,onSave:w,onCancel:o,saving:s}){const{t:a}=Y(),[h,d]=p.useState({question_text:(t==null?void 0:t.question_text)||"",question_type:(t==null?void 0:t.question_type)||"multiple_choice",options:(t==null?void 0:t.options)||[{id:"A",text:""},{id:"B",text:""},{id:"C",text:""},{id:"D",text:""}],correct_answer:(t==null?void 0:t.correct_answer)||"A",points:(t==null?void 0:t.points)||1,difficulty:(t==null?void 0:t.difficulty)||"medium",explanation:(t==null?void 0:t.explanation)||""}),r=x=>{if(x.preventDefault(),!h.question_text.trim()){u.error(a("validation.required"));return}w(h)},k=(x,y)=>{const b=[...h.options];b[x]={...b[x],text:y},d(P=>({...P,options:b}))},f=()=>{const x=String.fromCharCode(65+h.options.length);d(y=>({...y,options:[...y.options,{id:x,text:""}]}))},g=x=>{if(h.options.length<=oe)return;const b=h.options.filter((P,S)=>S!==x).map((P,S)=>({...P,id:String.fromCharCode(65+S)}));d(P=>{var S;return{...P,options:b,correct_answer:((S=b[0])==null?void 0:S.id)||"A"}})};return e.jsxs("form",{onSubmit:r,className:"p-4 bg-gray-50 rounded-xl space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[a("question.text")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("textarea",{value:h.question_text,onChange:x=>d(y=>({...y,question_text:x.target.value})),placeholder:a("question.textPlaceholder"),rows:3,className:"input resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a("question.type")}),e.jsxs("select",{value:h.question_type,onChange:x=>d(y=>({...y,question_type:x.target.value})),className:"input",children:[e.jsx("option",{value:"multiple_choice",children:a("question.multipleChoice")}),e.jsx("option",{value:"true_false",children:a("question.trueFalse")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a("question.points")}),e.jsx("input",{type:"number",value:h.points,onChange:x=>d(y=>({...y,points:parseFloat(x.target.value)||1})),min:.5,step:.5,className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a("question.difficulty")}),e.jsxs("select",{value:h.difficulty,onChange:x=>d(y=>({...y,difficulty:x.target.value})),className:"input",children:[e.jsx("option",{value:"easy",children:a("question.difficultyEasy")}),e.jsx("option",{value:"medium",children:a("question.difficultyMedium")}),e.jsx("option",{value:"hard",children:a("question.difficultyHard")})]})]})]}),h.question_type==="multiple_choice"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("question.options")}),e.jsx("div",{className:"space-y-2",children:h.options.map((x,y)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"correct_answer",checked:h.correct_answer===x.id,onChange:()=>d(b=>({...b,correct_answer:x.id})),className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center text-sm font-medium",children:x.id}),e.jsx("input",{type:"text",value:x.text,onChange:b=>k(y,b.target.value),placeholder:a("question.optionPlaceholder"),className:"input flex-1"}),h.options.length>oe&&e.jsx("button",{type:"button",onClick:()=>g(y),className:"p-2 hover:bg-danger-50 rounded-lg transition-colors text-danger",children:e.jsx(de,{className:"w-4 h-4"})})]},y))}),h.options.length<Ye&&e.jsxs("button",{type:"button",onClick:f,className:"mt-2 text-sm text-primary hover:text-primary-700 flex items-center",children:[e.jsx(U,{className:"w-4 h-4 mr-1"}),a("question.addOption")]})]}),h.question_type==="true_false"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:a("question.correctAnswer")}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"tf_answer",checked:h.correct_answer===!0||h.correct_answer==="true",onChange:()=>d(x=>({...x,correct_answer:!0})),className:"w-4 h-4 text-primary"}),e.jsx("span",{children:a("common.yes")})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"tf_answer",checked:h.correct_answer===!1||h.correct_answer==="false",onChange:()=>d(x=>({...x,correct_answer:!1})),className:"w-4 h-4 text-primary"}),e.jsx("span",{children:a("common.no")})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a("question.explanation")}),e.jsx("textarea",{value:h.explanation,onChange:x=>d(y=>({...y,explanation:x.target.value})),placeholder:a("question.explanationPlaceholder"),rows:2,className:"input resize-none"})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:o,className:"btn-secondary",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:s,className:"btn-primary",children:[s&&e.jsx(B,{className:"w-4 h-4 mr-2 animate-spin"}),a("common.save")]})]})]})}function Xe({classId:t,exams:w}){const{t:o}=Y(),[s,a]=p.useState(!1),[h,d]=p.useState(""),[r,k]=p.useState([]),[f,g]=p.useState(null),[x,y]=p.useState(null),[b,P]=p.useState({});p.useEffect(()=>{(async()=>{if(!h){k([]),g(null);return}a(!0);try{const{data:N,error:$}=await I.from("exam_sessions").select(`
            *,
            student:profiles(id, full_name, email, student_id)
          `).eq("exam_id",h).order("submitted_at",{ascending:!1});if($)throw $;if(k(N||[]),N&&N.length>0){const m=N.filter(_=>_.status==="submitted"||_.status==="auto_submitted"),M=m.length>0?m.reduce((_,D)=>_+(D.percentage||0),0)/m.length:0,O=m.filter(_=>_.passed).length,j=m.length>0?m.reduce((_,D)=>_+(D.cheat_count||0)+(D.tab_violations||0),0)/m.length:0,A=m.filter(_=>_.is_flagged||(_.cheat_count||0)>2).length;g({totalStudents:N.length,submittedCount:m.length,avgScore:M.toFixed(1),passRate:m.length>0?(O/m.length*100).toFixed(1):0,avgViolations:j.toFixed(1),flaggedCount:A,highestScore:m.length>0?Math.max(...m.map(_=>_.percentage||0)).toFixed(1):0,lowestScore:m.length>0?Math.min(...m.map(_=>_.percentage||0)).toFixed(1):0})}else g(null)}catch(N){console.error("Load sessions error:",N),u.error(o("error.general"))}finally{a(!1)}})()},[h,o]);const S=l=>l?new Date(l).toLocaleString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",i=l=>{const N=(l.cheat_count||0)+(l.tab_violations||0)+(l.fullscreen_violations||0);return N===0?{label:o("analytics.integrity.good"),color:"bg-success-100 text-success-700"}:N<=3?{label:o("analytics.integrity.warning"),color:"bg-warning-100 text-warning-700"}:{label:o("analytics.integrity.suspicious"),color:"bg-danger-100 text-danger-700"}},c=async l=>{if(b[l]){y(x===l?null:l);return}try{const{data:N,error:$}=await I.from("proctoring_logs").select("*").eq("session_id",l).order("timestamp",{ascending:!0});if($)throw $;P(m=>({...m,[l]:N||[]})),y(l)}catch(N){console.error("Failed to load proctoring logs:",N),u.error("Failed to load evidence")}},v=l=>({tab_switch:"Tab Switch",fullscreen_exit:"Fullscreen Exit",multi_screen:"Multiple Screens",object_detected:"Object Detected",face_not_detected:"Face Not Detected",gaze_away:"Looking Away",copy_paste_attempt:"Copy/Paste",right_click:"Right Click",keyboard_shortcut:"Keyboard Shortcut",remote_desktop_detected:"Remote Desktop",screen_share_detected:"Screen Sharing",ai_alert:"AI Detection",manual_flag:"Manual Flag"})[l]||l,E=l=>{switch(l){case"critical":return"bg-danger-100 text-danger-700";case"warning":return"bg-warning-100 text-warning-700";case"info":return"bg-gray-100 text-gray-700";default:return"bg-gray-100 text-gray-600"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold text-text-main",children:o("tabs.analytics")}),e.jsx("div",{className:"w-64",children:e.jsxs("select",{value:h,onChange:l=>d(l.target.value),className:"input",children:[e.jsx("option",{value:"",children:o("analytics.selectExam")}),w.map(l=>e.jsx("option",{value:l.id,children:l.title},l.id))]})})]}),h?s?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(B,{className:"w-8 h-8 animate-spin text-primary"})}):f?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"card",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:o("analytics.totalStudents")}),e.jsxs("p",{className:"text-2xl font-bold text-text-main",children:[f.submittedCount,"/",f.totalStudents]})]}),e.jsxs("div",{className:"card",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:o("analytics.avgScore")}),e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[f.avgScore,"%"]})]}),e.jsxs("div",{className:"card",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:o("analytics.passRate")}),e.jsxs("p",{className:"text-2xl font-bold text-success",children:[f.passRate,"%"]})]}),e.jsxs("div",{className:"card",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:o("analytics.flagged")}),e.jsx("p",{className:"text-2xl font-bold text-danger",children:f.flaggedCount})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:o("analytics.scoreDistribution")}),e.jsx("div",{className:"space-y-3 mb-6",children:(()=>{const l=[{label:"90-100%",min:90,max:100,color:"bg-success-600"},{label:"80-89%",min:80,max:89,color:"bg-success-500"},{label:"70-79%",min:70,max:79,color:"bg-primary"},{label:"60-69%",min:60,max:69,color:"bg-warning-500"},{label:"50-59%",min:50,max:59,color:"bg-warning-600"},{label:"0-49%",min:0,max:49,color:"bg-danger"}],N=r.filter(m=>m.status==="submitted"||m.status==="auto_submitted"),$=N.length||1;return l.map(m=>{const M=N.filter(j=>(j.percentage||0)>=m.min&&(j.percentage||0)<=m.max).length,O=M/$*100;return e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-sm text-gray-600 w-20",children:m.label}),e.jsx("div",{className:"flex-1 h-6 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${m.color} transition-all duration-500`,style:{width:`${O}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-700 w-16 text-right",children:[M," (",O.toFixed(0),"%)"]})]},m.label)})})()}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-success rounded-full"}),e.jsxs("span",{children:[o("analytics.highestScore"),": ",f.highestScore,"%"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-danger rounded-full"}),e.jsxs("span",{children:[o("analytics.lowestScore"),": ",f.lowestScore,"%"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-primary rounded-full"}),e.jsxs("span",{children:[o("analytics.avgScore"),": ",f.avgScore,"%"]})]})]})]}),e.jsx("div",{className:"card overflow-hidden p-0",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-gray-700",children:o("table.number")}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-gray-700",children:o("table.name")}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-gray-700",children:o("analytics.score")}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-gray-700",children:o("analytics.submittedAt")}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-gray-700",children:o("analytics.violations")}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-gray-700",children:o("analytics.integrity")}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-gray-700",children:o("table.status")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:r.map((l,N)=>{var O,j,A;const $=i(l),m=x===l.id,M=b[l.id]||[];return e.jsxs(we.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>c(l.id),children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:N+1}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-text-main",children:((O=l.student)==null?void 0:O.full_name)||"N/A"}),e.jsx("p",{className:"text-xs text-gray-500",children:(j=l.student)==null?void 0:j.email})]})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsxs("span",{className:`font-bold ${l.passed?"text-success":"text-danger"}`,children:[((A=l.percentage)==null?void 0:A.toFixed(1))||0,"%"]}),e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",l.total_score,"/",l.max_score,")"]})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:S(l.submitted_at)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[e.jsxs("span",{className:"px-2 py-0.5 bg-warning-50 text-warning-700 rounded",children:["AI: ",l.cheat_count||0]}),e.jsxs("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 rounded",children:["Tab: ",l.tab_violations||0]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${$.color}`,children:$.label})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`badge ${l.status==="submitted"?"badge-success":l.status==="auto_submitted"?"bg-warning-100 text-warning-700":l.status==="in_progress"?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-600"}`,children:l.status==="submitted"?o("analytics.status.submitted"):l.status==="auto_submitted"?o("analytics.status.autoSubmitted"):l.status==="in_progress"?o("analytics.status.inProgress"):l.status})})]}),m&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-4 bg-gray-50",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 flex items-center space-x-2",children:[e.jsx(ne,{className:"w-4 h-4 text-primary"}),e.jsx("span",{children:"Proctoring Evidence Timeline"}),e.jsxs("span",{className:"text-xs font-normal text-gray-500",children:["(",M.length," events)"]})]}),M.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No violations recorded"}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:M.map(_=>e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${E(_.severity)}`,children:_.severity}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:v(_.event_type)})]}),e.jsx("span",{className:"text-xs text-gray-500",children:S(_.timestamp)})]}),_.details&&Object.keys(_.details).length>0&&e.jsxs("div",{className:"mb-2 p-2 bg-gray-50 rounded",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-1",children:"Details:"}),e.jsx("div",{className:"text-xs text-gray-600 space-y-0.5",children:Object.entries(_.details).map(([D,Q])=>e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[D,":"]})," ",String(Q)]},D))})]}),_.screenshot_url&&e.jsxs("div",{className:"mt-2",children:[e.jsx("img",{src:_.screenshot_url,alt:"Evidence",className:"rounded border border-gray-300 max-w-md cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>window.open(_.screenshot_url,"_blank")}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Click to view full size"})]})]},_.id))})]})})})]},l.id)})})]})})]}):e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-xl",children:[e.jsx(se,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-gray-500",children:o("analytics.noData")})]}):e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-xl",children:[e.jsx(se,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-gray-500",children:o("analytics.selectExamPrompt")})]})]})}function Je(){const t=new Date().getFullYear(),w=[];for(let o=-5;o<=Se;o++){const s=t+o;w.push(`${s}-${s+1}`)}return w}function He({onClose:t,onSuccess:w}){const{user:o}=te(),{t:s}=Y(),[a,h]=p.useState(!1),[d,r]=p.useState(0),k=3,f=new Date().getFullYear(),[g,x]=p.useState({name:"",code:"",description:"",semester:"",academic_year:`${f}-${f+1}`}),y=Je(),b=S=>{const{name:i,value:c}=S.target;x(v=>({...v,[i]:c}))},P=async S=>{if(S.preventDefault(),a)return;const i=g.name.trim(),c=g.code.trim();if(!i||!c){u.error(s("validation.enterNameAndCode"));return}if(!Re(c)){u.error(s("validation.invalidClassCode"));return}if(i.length>100){u.error(s("validation.classNameTooLong"));return}h(!0);const v=async(E=0)=>{var l,N,$,m,M,O;try{const A=new Promise((X,J)=>setTimeout(()=>J(new Error("REQUEST_TIMEOUT")),15e3)),_=I.rpc("create_class",{p_name:i,p_code:c,p_description:((l=g.description)==null?void 0:l.trim())||null,p_semester:g.semester||null,p_academic_year:g.academic_year||null}),{data:D,error:Q}=await Promise.race([_,A]);if(Q)throw Q;if(D&&!D.success){D.error==="duplicate_code"?u.error(s("class.duplicateCode")):D.error==="not_authorized"?u.error(s("class.noPermission")):D.error==="profile_not_found"?u.error(s("error.sessionExpired")):u.error(s("class.createError"));return}let L=null;if(D!=null&&D.class_id){const{data:X,error:J}=await I.from("classes").select("*").eq("id",D.class_id).single();!J&&X?L=X:L={id:D.class_id,name:i,code:c,description:((N=g.description)==null?void 0:N.trim())||null,semester:g.semester||null,academic_year:g.academic_year||null,instructor_id:o==null?void 0:o.id,is_active:!0,created_at:new Date().toISOString()}}else console.warn("RPC create_class succeeded but no class_id returned"),L={id:crypto.randomUUID?crypto.randomUUID():Date.now().toString(),name:i,code:c,description:(($=g.description)==null?void 0:$.trim())||null,semester:g.semester||null,academic_year:g.academic_year||null,instructor_id:o==null?void 0:o.id,is_active:!0,created_at:new Date().toISOString()};u.success(s("class.createSuccess")),w==null||w(L),t()}catch(j){if(console.error("Create class error:",j),j.message==="REQUEST_TIMEOUT"){if(E<k)return r(E+1),u.info(s("error.retrying",{attempt:E+1,max:k})),await new Promise(A=>setTimeout(A,1e3)),v(E+1);u.error(s("error.timeout"))}else j.code==="23505"?u.error(s("class.duplicateCode")):j.code==="42501"||(m=j.message)!=null&&m.includes("permission")?u.error(s("class.noPermission")):(M=j.message)!=null&&M.includes("network")||(O=j.message)!=null&&O.includes("fetch")?u.error(s("error.network")):u.error(s("class.createError"));r(0)}finally{h(!1)}};await v(0)};return e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("class.name")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",name:"name",value:g.name,onChange:b,placeholder:s("class.namePlaceholder"),className:"input"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("class.code")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",name:"code",value:g.code,onChange:b,placeholder:s("class.codePlaceholder"),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("class.description")}),e.jsx("textarea",{name:"description",value:g.description,onChange:b,placeholder:s("class.descriptionPlaceholder"),rows:2,className:"input resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("class.semester")}),e.jsxs("select",{name:"semester",value:g.semester,onChange:b,className:"input",children:[e.jsx("option",{value:"",children:s("class.semesterSelect")}),e.jsx("option",{value:"1",children:s("class.semester1")}),e.jsx("option",{value:"2",children:s("class.semester2")}),e.jsx("option",{value:"3",children:s("class.semesterSummer")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("class.year")}),e.jsx("select",{name:"academic_year",value:g.academic_year,onChange:b,className:"input",children:y.map(S=>e.jsx("option",{value:S,children:S},S))})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:t,className:"btn-secondary",children:s("common.cancel")}),e.jsxs("button",{type:"submit",disabled:a,className:"btn-primary",children:[a?e.jsx(B,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(ae,{className:"w-5 h-5 mr-2"}),s("instructor.createClass")]})]})]})}function ns(){const{user:t,profile:w,logout:o}=te(),{t:s}=Y(),a=_e(),[h,d]=p.useState([]),[r,k]=p.useState(null),[f,g]=p.useState([]),[x,y]=p.useState([]),[b,P]=p.useState({totalStudents:0,totalExams:0,activeExams:0,flaggedSessions:0}),[S,i]=p.useState(!0),[c,v]=p.useState("exams"),[E,l]=p.useState(!1),[N,$]=p.useState(!1),[m,M]=p.useState(null),[O,j]=p.useState(!1),[A,_]=p.useState(!1),[D,Q]=p.useState(!1),[L,X]=p.useState(null),[J,ue]=p.useState(""),[Ge,Ke]=p.useState([]),[We,Ze]=p.useState(null),[he,ie]=p.useState(!1),pe=n=>{M(n),$(!0)};p.useEffect(()=>{(async()=>{if(t)try{const{data:C,error:T}=await I.from("classes").select("*").eq("instructor_id",t.id).order("created_at",{ascending:!1});if(T)throw T;d(C||[]),C&&C.length>0&&!r&&k(C[0])}catch(C){console.error("Load classes error:",C)}finally{i(!1)}})()},[t]),p.useEffect(()=>{if(!r)return;const n=async()=>{try{const{data:T}=await I.from("exams").select("*").eq("class_id",r.id).order("created_at",{ascending:!1});g(T||[]);let F=[],z=null;try{const{data:q,error:R}=await I.rpc("get_class_enrollments",{p_class_id:r.id});if(!R&&(q!=null&&q.success))F=q.enrollments||[];else{const Ne=(R==null?void 0:R.message)||(q==null?void 0:q.error)||"Unknown RPC error";throw new Error(`get_class_enrollments RPC failed: ${Ne}. This may occur if the RPC function is not deployed in Supabase.`)}}catch(q){console.warn("[InstructorDashboard] RPC get_class_enrollments failed, trying direct query:",q.message||q);const R=await I.from("enrollments").select(`
              *,
              student:profiles(*)
            `).eq("class_id",r.id);F=R.data||[],z=R.error,z&&console.error("[InstructorDashboard] Error loading enrollments:",z)}y(F);const H=(T||[]).filter(q=>q.status==="published").length;P({totalStudents:(F||[]).length,totalExams:(T||[]).length,activeExams:H,flaggedSessions:0})}catch(T){console.error("Load class data error:",T)}};n();const C=I.channel(`enrollments-class-${r.id}`).on("postgres_changes",{event:"*",schema:"public",table:"enrollments",filter:`class_id=eq.${r.id}`},T=>{console.log("Enrollment change detected:",T),n(),T.eventType==="INSERT"&&u.success(s("student.studentJoined"))}).subscribe();return()=>{C.unsubscribe()}},[r,s]);const ge=async()=>{await o(),a("/login")},ye=async n=>{try{const{error:C}=await I.from("exams").update({status:"published"}).eq("id",n);if(C)throw C;g(T=>T.map(F=>F.id===n?{...F,status:"published"}:F)),u.success(s("exam.published"))}catch{u.error(s("error.general"))}},fe=async n=>{if(window.confirm(s("student.removeConfirm")))try{const{error:C}=await I.from("enrollments").delete().eq("id",n);if(C)throw C;y(T=>T.filter(F=>F.id!==n)),u.success(s("student.removeSuccess"))}catch{u.error(s("error.general"))}},je=n=>new Date(n).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),be=n=>{const C=new Date,T=new Date(n.start_time),F=new Date(n.end_time);return n.status==="draft"?{label:s("exam.status.draft"),color:"bg-gray-100 text-gray-700"}:C<T?{label:s("exam.status.upcoming"),color:"bg-primary-100 text-primary-700"}:C>F?{label:s("exam.status.ended"),color:"bg-gray-100 text-gray-600"}:{label:s("exam.status.active"),color:"bg-success-100 text-success-700"}};return S?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(B,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("nav",{className:"bg-paper shadow-sm border-b border-gray-200 px-6 py-4 flex justify-between items-center sticky top-0 z-10",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-primary p-2 rounded-lg",children:e.jsx(Ce,{className:"text-white w-6 h-6"})}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-xl font-bold text-text-main tracking-tight",children:["SmartExam",e.jsx("span",{className:"text-primary",children:"Pro"})]}),e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:s("instructor.title")})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(ke,{compact:!0}),e.jsxs("button",{onClick:()=>ie(!0),className:"flex items-center space-x-2 text-sm font-medium text-gray-600 bg-gray-100 px-3 py-1.5 rounded-full hover:bg-gray-200 transition-colors cursor-pointer",title:s("profile.settings")||"CÃ i Ä‘áº·t tÃ i khoáº£n",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("span",{children:(w==null?void 0:w.full_name)||(t==null?void 0:t.email)}),e.jsx(Te,{className:"w-3.5 h-3.5 text-gray-400"})]}),e.jsxs("button",{onClick:ge,className:"flex items-center space-x-2 text-danger hover:bg-danger-50 px-4 py-2 rounded-lg transition-colors text-sm font-semibold",children:[e.jsx(Me,{className:"w-4 h-4"}),e.jsx("span",{children:s("auth.logout")})]})]})]}),e.jsx(Pe,{isOpen:he,onClose:()=>ie(!1)}),e.jsxs("div",{className:"flex",children:[e.jsxs("aside",{className:"w-64 bg-paper border-r border-gray-200 min-h-[calc(100vh-65px)] p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"font-bold text-gray-700",children:s("instructor.classes")}),e.jsx("button",{onClick:()=>_(!0),className:"p-1.5 hover:bg-primary-50 rounded-lg transition-colors",title:s("instructor.createClass"),children:e.jsx(U,{className:"w-5 h-5 text-primary"})})]}),e.jsxs("div",{className:"space-y-2",children:[h.map(n=>e.jsxs("button",{onClick:()=>k(n),className:`w-full text-left p-3 rounded-xl transition-all ${(r==null?void 0:r.id)===n.id?"bg-primary-50 border-2 border-primary":"bg-gray-50 hover:bg-gray-100 border-2 border-transparent"}`,children:[e.jsx("p",{className:`font-semibold text-sm ${(r==null?void 0:r.id)===n.id?"text-primary":"text-gray-800"}`,children:n.name}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:n.code})]},n.id)),h.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(W,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:s("instructor.noClasses")}),e.jsx("button",{onClick:()=>_(!0),className:"text-primary text-sm mt-2 hover:underline",children:s("instructor.createFirstClass")})]})]})]}),e.jsx("main",{className:"flex-1 p-6",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-text-main",children:r.name}),e.jsxs("p",{className:"text-gray-500",children:[s("instructor.classCode"),": ",r.code]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"card flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-primary-100 rounded-xl",children:e.jsx(ee,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-text-main",children:b.totalStudents}),e.jsx("p",{className:"text-sm text-gray-500",children:s("stats.students")})]})]}),e.jsxs("div",{className:"card flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-success-100 rounded-xl",children:e.jsx(K,{className:"w-6 h-6 text-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-text-main",children:b.totalExams}),e.jsx("p",{className:"text-sm text-gray-500",children:s("stats.exams")})]})]}),e.jsxs("div",{className:"card flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-warning-100 rounded-xl",children:e.jsx(Ae,{className:"w-6 h-6 text-warning"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-text-main",children:b.activeExams}),e.jsx("p",{className:"text-sm text-gray-500",children:s("stats.active")})]})]}),e.jsxs("div",{className:"card flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-danger-100 rounded-xl",children:e.jsx(ve,{className:"w-6 h-6 text-danger"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-text-main",children:b.flaggedSessions}),e.jsx("p",{className:"text-sm text-gray-500",children:s("stats.suspicious")})]})]})]}),e.jsx("div",{className:"flex space-x-1 p-1 bg-gray-100 rounded-xl mb-6 w-fit",children:[{id:"exams",label:s("tabs.exams"),icon:K},{id:"students",label:s("tabs.students"),icon:ee},{id:"analytics",label:s("tabs.analytics"),icon:se}].map(n=>e.jsxs("button",{onClick:()=>v(n.id),className:`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${c===n.id?"bg-white shadow text-primary":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(n.icon,{className:"w-4 h-4"}),e.jsx("span",{children:n.label})]},n.id))}),c==="exams"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-text-main",children:s("tabs.exams")}),e.jsxs("button",{onClick:()=>l(!0),className:"btn-primary",children:[e.jsx(U,{className:"w-5 h-5 mr-2"}),s("exam.create")]})]}),f.length>0?e.jsx("div",{className:"space-y-3",children:f.map(n=>{const C=be(n);return e.jsx("div",{className:"card hover:shadow-soft transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h3",{className:"font-semibold text-text-main",children:n.title}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${C.color}`,children:C.label})]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsxs("span",{children:[n.duration_minutes," ",s("exam.minutes")]})]}),e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(Fe,{className:"w-4 h-4"}),e.jsx("span",{children:je(n.start_time)})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>pe(n),className:"btn-secondary text-sm",title:s("exam.edit"),children:[e.jsx(me,{className:"w-4 h-4 mr-1"}),s("exam.edit")]}),n.status==="draft"&&e.jsxs("button",{onClick:()=>ye(n.id),className:"btn-success text-sm",children:[e.jsx(Ie,{className:"w-4 h-4 mr-1"}),s("exam.publish")]}),e.jsxs("button",{onClick:()=>{X(n),Q(!0)},className:"btn-secondary text-sm",title:s("exam.manageQuestions"),children:[e.jsx(K,{className:"w-4 h-4 mr-1"}),s("exam.manageQuestions")]})]})]})},n.id)})}):e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-xl",children:[e.jsx(K,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-gray-500 mb-4",children:s("exam.noExams")}),e.jsxs("button",{onClick:()=>l(!0),className:"btn-primary",children:[e.jsx(U,{className:"w-5 h-5 mr-2"}),s("exam.createFirst")]})]})]}),c==="students"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-text-main",children:s("tabs.students")}),e.jsxs("button",{onClick:()=>j(!0),className:"btn-primary",children:[e.jsx(U,{className:"w-5 h-5 mr-2"}),s("student.add")]})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Oe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:s("student.searchPlaceholder"),value:J,onChange:n=>ue(n.target.value),className:"input pl-10"})]}),x.length>0?e.jsx("div",{className:"card overflow-hidden p-0",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-gray-700",children:s("table.number")}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-gray-700",children:s("table.name")}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-gray-700",children:s("table.email")}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-gray-700",children:s("table.studentId")}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-gray-700",children:s("student.enrolledAt")}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-gray-700",children:s("table.status")}),e.jsx("th",{className:"text-right px-4 py-3 text-sm font-semibold text-gray-700",children:s("table.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:x.filter(n=>{var T,F,z,H,q,R;if(!J)return!0;const C=J.toLowerCase();return((F=(T=n.student)==null?void 0:T.full_name)==null?void 0:F.toLowerCase().includes(C))||((H=(z=n.student)==null?void 0:z.email)==null?void 0:H.toLowerCase().includes(C))||((R=(q=n.student)==null?void 0:q.student_id)==null?void 0:R.toLowerCase().includes(C))}).map((n,C)=>{var F,z,H;const T=n.enrolled_at&&Date.now()-new Date(n.enrolled_at).getTime()<3e5;return e.jsxs("tr",{className:`hover:bg-gray-50 transition-colors ${T?"bg-success-50":""}`,children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:C+1}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${T?"bg-success-100 ring-2 ring-success-300 ring-offset-1":"bg-primary-100"}`,children:e.jsx(De,{className:`w-4 h-4 ${T?"text-success":"text-primary"}`})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium text-text-main",children:((F=n.student)==null?void 0:F.full_name)||"N/A"}),T&&e.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-bold uppercase bg-success text-white rounded animate-pulse",children:"NEW"})]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:(z=n.student)==null?void 0:z.email}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:((H=n.student)==null?void 0:H.student_id)||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:n.enrolled_at?new Date(n.enrolled_at).toLocaleString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`badge ${n.status==="active"?"badge-success":"bg-gray-100 text-gray-600"}`,children:n.status==="active"?s("student.statusActive"):n.status})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("button",{onClick:()=>fe(n.id),className:"p-2 hover:bg-danger-50 rounded-lg transition-colors text-danger",title:s("student.remove"),children:e.jsx(xe,{className:"w-4 h-4"})})})]},n.id)})})]})}):e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-xl",children:[e.jsx(ee,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-gray-500 mb-4",children:s("student.noStudents")}),e.jsxs("button",{onClick:()=>j(!0),className:"btn-primary",children:[e.jsx(U,{className:"w-5 h-5 mr-2"}),s("student.add")]})]})]}),c==="analytics"&&e.jsx(Xe,{classId:r==null?void 0:r.id,exams:f})]}):e.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(W,{className:"w-20 h-20 mx-auto mb-4 text-gray-300"}),e.jsx("h2",{className:"text-xl font-bold text-gray-700 mb-2",children:s("instructor.welcome")}),e.jsx("p",{className:"text-gray-500 mb-6",children:s("instructor.welcomeDesc")}),e.jsxs("button",{onClick:()=>_(!0),className:"btn-primary",children:[e.jsx(U,{className:"w-5 h-5 mr-2"}),s("instructor.createClass")]})]})})})]}),e.jsx(G,{isOpen:A,onClose:()=>_(!1),title:s("instructor.createClassTitle"),children:e.jsx(He,{onClose:()=>_(!1),onSuccess:n=>{d(C=>[n,...C]),k(n)}})}),e.jsx(G,{isOpen:E,onClose:()=>l(!1),title:s("instructor.createExamTitle"),children:e.jsx(Ue,{classId:r==null?void 0:r.id,onClose:()=>l(!1),onSuccess:n=>{g(C=>[n,...C])}})}),e.jsx(G,{isOpen:N,onClose:()=>{$(!1),M(null)},title:s("instructor.editExamTitle"),children:m&&e.jsx(Qe,{exam:m,onClose:()=>{$(!1),M(null)},onSuccess:n=>{g(C=>C.map(T=>T.id===n.id?n:T))}})}),e.jsx(G,{isOpen:O,onClose:()=>j(!1),title:s("instructor.addStudentTitle"),children:e.jsx(ze,{classId:r==null?void 0:r.id,onClose:()=>j(!1),onSuccess:()=>{r&&I.from("enrollments").select("*, student:profiles(*)").eq("class_id",r.id).then(({data:n})=>y(n||[]))}})}),e.jsx(G,{isOpen:D,onClose:()=>{Q(!1),X(null)},title:s("exam.manageQuestions"),children:L&&e.jsx(Ve,{examId:L.id,examTitle:L.title,onClose:()=>{Q(!1),X(null)}})})]})}export{ns as default};
