import{c as o,u as H,a as z,r as u,j as e,B as r,s as R}from"./index-ChfUvB8y.js";import{X as G,S as I,C as N,b as B,F as D}from"./FaceVerification-BUUkxcGo.js";import{A as k,m as p,U as w,L as T}from"./proxy-6ledvSkN.js";import{M as U,I as q}from"./LanguageSwitcher-Cm5FU-82.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=o("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=o("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=o("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=o("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=o("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=o("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=o("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),C=2,_=100;function te({isOpen:M,onClose:m}){const{user:g,profile:a,updateProfile:S,refetchProfile:V}=H(),{t}=z(),[y,b]=u.useState(!1),[L,d]=u.useState(!1),[c,j]=u.useState({full_name:"",student_id:"",phone:"",department:""});u.useEffect(()=>{a&&j({full_name:a.full_name||"",student_id:a.student_id||"",phone:a.phone||"",department:a.department||""})},[a]);const f=n=>{const{name:l,value:i}=n.target;j(x=>({...x,[l]:i}))},E=async n=>{var i,x,v;if(n.preventDefault(),y)return;const l=c.full_name.trim();if(!l){r.error(t("validation.required")||"Vui lòng nhập tên");return}if(l.length<C||l.length>_){r.error(t("validation.nameLengthInvalid")||`Tên phải từ ${C}-${_} ký tự`);return}b(!0);try{const{error:s}=await S({full_name:l,student_id:((i=c.student_id)==null?void 0:i.trim())||null,phone:((x=c.phone)==null?void 0:x.trim())||null,department:((v=c.department)==null?void 0:v.trim())||null});if(s)throw s;r.success(t("profile.updateSuccess")||"Cập nhật thông tin thành công!"),m==null||m()}catch(s){console.error("Profile update error:",s);const A=(s==null?void 0:s.message)||(s==null?void 0:s.details)||t("error.general")||"Có lỗi xảy ra";r.error(A)}finally{b(!1)}},F=async(n,l)=>{try{const{error:i}=await R.rpc("update_face_embedding",{p_embedding:n,p_image_url:l});if(i){console.error("Error saving face embedding:",i),r.error(t("error.general")||"Có lỗi xảy ra");return}d(!1),await V(),r.success(t("profile.faceRegisteredSuccess")||"Cập nhật khuôn mặt thành công!")}catch(i){console.error("Face registration error:",i),r.error(t("error.general")||"Có lỗi xảy ra")}},h=!!(a!=null&&a.face_embedding||a!=null&&a.face_enrolled_at),P=(a==null?void 0:a.role)==="student";return M?e.jsx(k,{children:e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:m,role:"dialog","aria-modal":"true","aria-labelledby":"profile-settings-title","aria-describedby":"profile-settings-desc",children:[e.jsxs(p.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-paper rounded-2xl shadow-xl max-w-lg w-full max-h-[90vh] overflow-hidden",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(w,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{id:"profile-settings-title",className:"text-xl font-bold text-text-main",children:t("profile.settingsTitle")||"Cài đặt tài khoản"}),e.jsx("p",{id:"profile-settings-desc",className:"text-sm text-gray-500",children:t("profile.settingsDesc")||"Cập nhật thông tin cá nhân"})]})]}),e.jsx("button",{onClick:m,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(G,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto",style:{maxHeight:"calc(90vh - 100px)"},children:e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(U,{className:"w-4 h-4 inline mr-1"}),"Email"]}),e.jsx("input",{type:"email",value:(g==null?void 0:g.email)||"",disabled:!0,className:"input bg-gray-100 cursor-not-allowed"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t("profile.emailCannotChange")||"Email không thể thay đổi"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx($,{className:"w-4 h-4 inline mr-1"}),t("profile.role")||"Vai trò"]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{className:`px-3 py-1.5 rounded-full text-sm font-medium ${(a==null?void 0:a.role)==="instructor"||(a==null?void 0:a.role)==="admin"?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-700"}`,children:(a==null?void 0:a.role)==="instructor"?t("auth.instructor")||"Giảng viên":(a==null?void 0:a.role)==="admin"?"Admin":t("auth.student")||"Sinh viên"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(w,{className:"w-4 h-4 inline mr-1"}),t("auth.fullName")||"Họ và tên"," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",name:"full_name",value:c.full_name,onChange:f,placeholder:t("auth.fullNamePlaceholder")||"Nguyễn Văn A",className:"input"})]}),(a==null?void 0:a.role)==="student"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.jsx(q,{className:"w-4 h-4 inline mr-1"}),t("auth.studentId")||"Mã sinh viên"]}),e.jsx("input",{type:"text",name:"student_id",value:c.student_id,onChange:f,placeholder:"20210001",className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t("profile.department")||"Khoa/Phòng ban"}),e.jsx("input",{type:"text",name:"department",value:c.department,onChange:f,placeholder:t("profile.departmentPlaceholder")||"Ví dụ: Công nghệ thông tin",className:"input"})]}),P&&e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[h?e.jsx(I,{className:"w-5 h-5 text-success"}):e.jsx(N,{className:"w-5 h-5 text-warning"}),e.jsx("span",{className:"font-medium text-gray-700",children:t("profile.faceVerification")||"Xác minh khuôn mặt"})]}),h?e.jsxs("span",{className:"flex items-center text-sm text-success",children:[e.jsx(B,{className:"w-4 h-4 mr-1"}),t("profile.verified")||"Đã xác minh"]}):e.jsxs("span",{className:"flex items-center text-sm text-warning",children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),t("profile.notVerified")||"Chưa xác minh"]})]}),e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:t("profile.faceDesc")||"Đăng ký khuôn mặt để xác minh danh tính khi thi"}),e.jsxs("button",{type:"button",onClick:()=>d(!0),className:`w-full py-2 rounded-lg text-sm font-medium transition-colors ${h?"bg-gray-200 text-gray-700 hover:bg-gray-300":"bg-primary text-white hover:bg-primary-600"}`,children:[e.jsx(N,{className:"w-4 h-4 inline mr-2"}),h?t("profile.updateFace")||"Cập nhật ảnh":t("profile.registerFace")||"Đăng ký ngay"]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:m,className:"btn-secondary",children:t("common.cancel")||"Hủy"}),e.jsxs("button",{type:"submit",disabled:y,className:"btn-primary",children:[y?e.jsx(T,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(X,{className:"w-5 h-5 mr-2"}),t("common.save")||"Lưu thay đổi"]})]})]})})]}),e.jsx(k,{children:L&&e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/50 flex items-center justify-center p-4",onClick:()=>d(!1),role:"dialog","aria-modal":"true","aria-label":t("profile.faceRegistrationTitle")||"Face Registration",children:e.jsxs(p.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"max-w-2xl w-full",onClick:n=>n.stopPropagation(),children:[e.jsx(D,{mode:"enroll",onEnrollComplete:F,onFailure:()=>{r.error(t("face.failed")||"Đăng ký thất bại. Vui lòng thử lại.")}}),e.jsx("button",{onClick:()=>d(!1),className:"mt-4 w-full py-2 bg-gray-200 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-300 transition-colors",children:t("common.cancel")||"Hủy"})]})})})]})}):null}export{Y as B,O as C,$ as G,Z as L,te as P,ee as S,ae as U,X as a};
