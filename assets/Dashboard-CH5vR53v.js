import{c as L,u as V,a as z,b as B,r as m,j as e,s as b,B as f}from"./index-D8za2Eji.js";import{F as T,L as O}from"./LanguageSwitcher-6fnd7hW1.js";import{L as G,U as H,m as j}from"./proxy-D_OBTarg.js";import{L as J}from"./log-out-CyQAv6N1.js";import{C,a as K}from"./clock-Dk07LW5T.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=L("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h=L("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);function se(){var E;const{user:i,profile:n,profileLoading:x,logout:D}=V(),{t:s}=z(),g=B(),[y,N]=m.useState([]),[S,u]=m.useState(!0),[w,v]=m.useState(!1);m.useEffect(()=>{if(!x){v(!1);return}const t=setTimeout(()=>{console.warn("Dashboard: Profile loading timeout reached, proceeding with user metadata"),v(!0)},2e3);return()=>clearTimeout(t)},[x]),m.useEffect(()=>{(async()=>{var l,c;if(!i){u(!1);return}if(x&&!n&&!w)return;const a=(n==null?void 0:n.role)||((l=i==null?void 0:i.user_metadata)==null?void 0:l.role)||"student";if(a==="instructor"||a==="admin"){u(!1);return}try{const{data:r,error:o}=await b.from("enrollments").select("class_id").eq("student_id",i.id).eq("status","active");if(o)throw o;if(!r||r.length===0){N([]),u(!1);return}const $=r.map(d=>d.class_id),{data:R,error:_}=await b.from("exams").select(`
            *,
            class:classes(name, code)
          `).in("class_id",$).eq("status","published").order("start_time",{ascending:!0});if(_)throw _;const{data:U}=await b.from("exam_sessions").select("exam_id, status, percentage").eq("student_id",i.id),F=new Map((U||[]).map(d=>[d.exam_id,d])),M=(R||[]).map(d=>({...d,session:F.get(d.id)||null}));N(M)}catch(r){console.error("Load exams error:",r);const o=((c=r.message)==null?void 0:c.toLowerCase())||"";o.includes("network")||o.includes("fetch")?f.error(s("error.network")):o.includes("permission")||o.includes("unauthorized")?f.error(s("error.sessionExpired")):f.error(s("error.loadExams"))}finally{u(!1)}})()},[i,n,x,w,s]);const A=async()=>{await D(),g("/login")},I=t=>{var c,r;const a=new Date,p=new Date(t.start_time),l=new Date(t.end_time);return((c=t.session)==null?void 0:c.status)==="submitted"||((r=t.session)==null?void 0:r.status)==="auto_submitted"?{type:"completed",label:s("exam.status.completed"),color:"bg-success-100 text-success-700",icon:K,canTake:!1}:a<p?{type:"upcoming",label:s("exam.status.upcoming"),color:"bg-gray-100 text-gray-600",icon:C,canTake:!1}:a>l?{type:"ended",label:s("exam.status.ended"),color:"bg-gray-100 text-gray-500",icon:Q,canTake:!1}:{type:"active",label:s("exam.status.active"),color:"bg-primary-100 text-primary-700",icon:h,canTake:!0}},q=t=>new Date(t).toLocaleString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),P={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},k={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}};return S?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(G,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs("div",{className:"min-h-screen bg-background font-sans text-text-main",children:[e.jsxs("nav",{className:"bg-paper shadow-sm border-b border-gray-200 px-8 py-4 flex justify-between items-center sticky top-0 z-10",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"bg-primary p-2 rounded-lg",children:e.jsx(T,{className:"text-white w-6 h-6"})}),e.jsxs("span",{className:"text-xl font-bold text-text-main tracking-tight",children:["SmartExam",e.jsx("span",{className:"text-primary",children:"Pro"})]})]}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx(O,{compact:!0}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm font-medium text-gray-600 bg-gray-100 px-3 py-1.5 rounded-full",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{children:(n==null?void 0:n.full_name)||(i==null?void 0:i.email)})]}),e.jsxs("button",{onClick:A,className:"flex items-center space-x-2 text-danger hover:bg-danger-50 px-4 py-2 rounded-lg transition-colors text-sm font-semibold",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{children:s("auth.logout")})]})]})]}),e.jsxs(j.div,{variants:P,initial:"hidden",animate:"visible",className:"max-w-6xl mx-auto px-8 py-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-text-main",children:[s("dashboard.hello"),", ",((E=n==null?void 0:n.full_name)==null?void 0:E.split(" ").pop())||s("auth.student"),"! ðŸ‘‹"]}),e.jsx("p",{className:"text-gray-500 mt-2",children:s("dashboard.selectExam")})]}),y.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:y.map(t=>{var l,c,r;const a=I(t),p=a.icon;return e.jsxs(j.div,{variants:k,className:`card hover:shadow-soft transition-all group ${a.canTake?"":"opacity-75"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider ${a.color}`,children:a.label}),e.jsx(p,{className:`w-5 h-5 ${a.type==="active"?"text-primary":a.type==="completed"?"text-success":"text-gray-400"}`})]}),e.jsx("h3",{className:`text-xl font-bold mb-2 ${a.canTake?"text-text-main group-hover:text-primary":"text-gray-700"} transition-colors`,children:t.title}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-500 mb-4",children:[e.jsxs("p",{children:[s("exam.course"),": ",((l=t.class)==null?void 0:l.name)||"N/A"]}),e.jsxs("p",{children:[s("exam.code"),": ",((c=t.class)==null?void 0:c.code)||"N/A"]}),e.jsxs("p",{className:"flex items-center space-x-1",children:[e.jsx(C,{className:"w-4 h-4"}),e.jsxs("span",{children:[s("exam.duration"),": ",t.duration_minutes," ",s("exam.minutes")]})]})]}),a.type==="completed"&&((r=t.session)==null?void 0:r.percentage)!==null&&e.jsx("div",{className:"mb-4 p-3 bg-success-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[s("exam.score"),": ",e.jsxs("span",{className:"font-bold text-success-700",children:[t.session.percentage.toFixed(1),"%"]})]})}),a.type==="upcoming"&&e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg text-xs text-gray-500",children:e.jsxs("p",{children:[s("exam.startTime"),": ",q(t.start_time)]})}),a.canTake?e.jsxs("button",{onClick:()=>g(`/exam/${t.id}`),className:"w-full flex items-center justify-center space-x-2 btn-primary py-3",children:[e.jsx(h,{className:"w-5 h-5"}),e.jsx("span",{children:s("dashboard.enterExam")})]}):a.type==="completed"&&t.allow_review?e.jsx("button",{className:"w-full btn-secondary py-3",children:s("dashboard.reviewExam")}):e.jsx("button",{disabled:!0,className:"w-full bg-gray-200 text-gray-500 py-3 rounded-xl font-semibold cursor-not-allowed",children:a.type==="upcoming"?s("dashboard.notStarted"):a.type==="ended"?s("dashboard.expired"):s("dashboard.notAvailable")})]},t.id)})}):e.jsxs("div",{className:"text-center py-16 bg-paper rounded-2xl border border-gray-100",children:[e.jsx(T,{className:"w-20 h-20 mx-auto mb-4 text-gray-300"}),e.jsx("h2",{className:"text-xl font-bold text-gray-700 mb-2",children:s("dashboard.noExams")}),e.jsx("p",{className:"text-gray-500",children:s("dashboard.noExamsDesc")})]}),y.length===0&&e.jsxs("div",{className:"mt-8",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:s("dashboard.demoExam")}),e.jsxs(j.div,{variants:k,className:"card hover:shadow-soft transition-all group max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"bg-primary-100 text-primary-700 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider",children:"Demo"}),e.jsx(h,{className:"w-5 h-5 text-primary"})]}),e.jsx("h3",{className:"text-xl font-bold text-text-main mb-2 group-hover:text-primary transition-colors",children:"TrÃ­ tuá»‡ nhÃ¢n táº¡o (AI)"}),e.jsxs("p",{className:"text-gray-500 text-sm mb-6",children:[s("exam.code"),": INT3401 â€¢ ",s("exam.duration"),": 45 ",s("exam.minutes")]}),e.jsxs("button",{onClick:()=>g("/exam/demo"),className:"w-full flex items-center justify-center space-x-2 btn-primary py-3",children:[e.jsx(h,{className:"w-5 h-5"}),e.jsx("span",{children:s("dashboard.enterExam")})]})]})]})]})]})}export{se as default};
