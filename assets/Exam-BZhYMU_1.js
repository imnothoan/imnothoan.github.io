import{c as q,d as Dt,u as Rt,a as Ft,r as i,b as Lt,B as o,t as x,s as v,j as e,T as re}from"./index-DCeZEmk_.js";import{S as tt,b as be,c as ve,C as je,F as st,a as Ot}from"./FaceVerification-BJPBiBND.js";import{m as D,L as ne,A as Q}from"./proxy-DeKowzOt.js";import{C as Vt}from"./chevron-right-CKAtBuuj.js";import{E as qt,a as Ht}from"./eye-Dm3N354h.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=q("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=q("FlagOff",[["path",{d:"M8 2c3 0 5 2 8 2s4-1 4-1v11",key:"9rwyz9"}],["path",{d:"M4 22V4",key:"1plyxx"}],["path",{d:"M4 15s1-1 4-1 5 2 8 2",key:"1myooe"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=q("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=q("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=q("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=q("StickyNote",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=q("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=q("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),Kt=["teamviewer","anydesk","ultraviewer","parsec","vnc","remotedesktop","citrix","logmein","splashtop","chrome remote","microsoft remote","rdp","ammyy","supremo"],Ne=typeof navigator<"u"&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent),_e=["demo","1"],Ee=["demo-session","demo-session-id"],Bt=3e4,nt="SUBMIT_TIMEOUT",Gt=.85,Qt=["phoneDetected","headphonesDetected","materialDetected","multiPerson"];function rs(){const{id:g}=Dt(),{user:_,profile:Yt}=Rt(),{t:r}=Ft(),u=i.useRef(null),k=i.useRef(null),ce=i.useRef(null);i.useRef(null);const G=i.useRef(!1),R=Lt(),[C,Se]=i.useState(null),[S,ke]=i.useState([]),[F,at]=i.useState(0),[E,Ce]=i.useState({}),[A,Ae]=i.useState(new Set),[L,Me]=i.useState({}),[f,Y]=i.useState(null),[oe,Z]=i.useState(null),[it,ct]=i.useState(!1),[ot,Te]=i.useState(null),[Ie,De]=i.useState(0),[Re,lt]=i.useState(0),[Fe,dt]=i.useState(0),[Le,mt]=i.useState(0),[X,$]=i.useState(!1),[K,le]=i.useState("verify"),[de,Oe]=i.useState(null),[Zt,ut]=i.useState(0),[J,ee]=i.useState(null),[te,Ve]=i.useState(!navigator.onLine),[ht,me]=i.useState(!1),[qe,ue]=i.useState(!1),[He,xt]=i.useState(!1),[y,Ue]=i.useState(!1),[T,Pe]=i.useState(!1),[M,H]=i.useState("loading"),[We,ft]=i.useState(!1),[he,gt]=i.useState(!0),[pt,xe]=i.useState(!1),j=S[F],yt=i.useCallback(()=>{const t=navigator.userAgent.toLowerCase();for(const c of Kt)if(t.includes(c))return!0;const s=window.screen.width/window.screen.height,n=window.innerWidth/window.innerHeight;Math.abs(s-n)>.2&&console.warn("Suspicious screen ratio detected");try{const c=document.createElement("canvas"),a=c.getContext("webgl")||c.getContext("experimental-webgl");if(a){const l=a.getExtension("WEBGL_debug_renderer_info");if(l){const h=a.getParameter(l.UNMASKED_RENDERER_WEBGL).toLowerCase(),p=["vmware","virtualbox","parallels","hyper-v","swiftshader","llvmpipe"];for(const m of p)if(h.includes(m))return console.warn("Virtual machine renderer detected:",h),!0}}}catch(c){console.warn("WebGL check failed:",c)}return!1},[]),wt=i.useCallback(async()=>{try{if("isExtended"in window.screen&&window.screen.isExtended)return ue(!0),o.error("PH√ÅT HI·ªÜN 2 M√ÄN H√åNH! Vui l√≤ng ng·∫Øt k·∫øt n·ªëi m√†n h√¨nh ph·ª• ƒë·ªÉ thi.",{autoClose:!1}),!1;if("getScreenDetails"in window)try{const t=await window.getScreenDetails();if(t&&t.screens.length>1)return ue(!0),o.error(`PH√ÅT HI·ªÜN ${t.screens.length} M√ÄN H√åNH! Nghi v·∫•n gian l·∫≠n.`,{autoClose:!1}),!1}catch{console.warn("Screen details permission denied")}}catch(t){console.warn("Screen API not supported",t)}return ue(!1),!0},[]),ze=async()=>{try{const t=document.documentElement;t.requestFullscreen?await t.requestFullscreen():t.webkitRequestFullscreen?await t.webkitRequestFullscreen():t.mozRequestFullScreen?await t.mozRequestFullScreen():t.msRequestFullscreen&&await t.msRequestFullscreen(),me(!0)}catch{Ne?(console.warn("Safari fullscreen not fully supported, continuing without fullscreen requirement"),me(!0)):o.error(r("anticheat.fullscreenRequired"))}};i.useEffect(()=>{const t=()=>{const s=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);if(me(s),Ne){console.log("Safari fullscreen state change - skipping violation check");return}!s&&y&&!G.current&&dt(n=>{const c=n+1;return o.error(x("anticheat.fullscreenExit",{count:c})),P("fullscreen_exit",{count:c}),c})};return document.addEventListener("fullscreenchange",t),document.addEventListener("webkitfullscreenchange",t),document.addEventListener("mozfullscreenchange",t),document.addEventListener("MSFullscreenChange",t),()=>{document.removeEventListener("fullscreenchange",t),document.removeEventListener("webkitfullscreenchange",t),document.removeEventListener("mozfullscreenchange",t),document.removeEventListener("MSFullscreenChange",t)}},[y]),i.useEffect(()=>{const t=()=>{document.hidden&&y&&!G.current&&lt(s=>{const n=s+1;return o.warning(x("anticheat.tabSwitch",{count:n})),P("tab_switch",{count:n}),n})};return document.addEventListener("visibilitychange",t),()=>document.removeEventListener("visibilitychange",t)},[y]),i.useEffect(()=>{if(!y)return;const t=n=>{var a;const c=[{ctrl:!0,key:"c"},{ctrl:!0,key:"v"},{ctrl:!0,key:"p"},{ctrl:!0,key:"s"},{ctrl:!0,key:"f"},{ctrl:!0,shift:!0,key:"i"},{key:"F12"},{alt:!0,key:"Tab"},{key:"PrintScreen"}];for(const l of c)if((!l.ctrl||n.ctrlKey)&&(!l.shift||n.shiftKey)&&(!l.alt||n.altKey)&&(n.key.toLowerCase()===((a=l.key)==null?void 0:a.toLowerCase())||n.key===l.key)&&l.key){n.preventDefault(),o.warning("Ph√≠m t·∫Øt b·ªã v√¥ hi·ªáu h√≥a trong ph√≤ng thi!"),P("keyboard_shortcut",{key:n.key,ctrl:n.ctrlKey,alt:n.altKey,shift:n.shiftKey});return}},s=n=>{n.preventDefault(),o.warning("Click chu·ªôt ph·∫£i b·ªã v√¥ hi·ªáu h√≥a!"),P("right_click",{})};return document.addEventListener("keydown",t),document.addEventListener("contextmenu",s),()=>{document.removeEventListener("keydown",t),document.removeEventListener("contextmenu",s)}},[y]);const O=i.useRef(null),V=i.useRef(null),U=i.useRef(null),I=i.useRef(null),fe=t=>{O.current=t,u.current&&(u.current.srcObject=t),U.current||(U.current=document.createElement("canvas"),U.current.width=640,U.current.height=480,I.current=U.current.getContext("2d",{willReadFrequently:!0}))},$e=async()=>{H("loading");try{O.current&&O.current.getTracks().forEach(n=>n.stop());const t={video:{width:{ideal:640,min:320},height:{ideal:480,min:240},facingMode:"user"},audio:!1},s=await navigator.mediaDevices.getUserMedia(t);fe(s),H("ready"),o.success(r("proctoring.camera")+" OK")}catch(t){console.error("Camera retry error:",t),H("error"),o.error(r("anticheat.cameraAccess"))}};i.useEffect(()=>((async()=>{H("loading");try{const s={video:{width:{ideal:640,min:320},height:{ideal:480,min:240},facingMode:"user"},audio:!1},n=await navigator.mediaDevices.getUserMedia(s);fe(n),H("ready")}catch(s){if(console.error("Camera access error:",s),H("error"),s.name==="NotAllowedError"||s.name==="PermissionDeniedError")o.error(r("anticheat.cameraAccess")+" (Permission denied)");else if(s.name==="NotFoundError"||s.name==="DevicesNotFoundError")o.error(r("anticheat.cameraAccess")+" (No camera found)");else if(s.name==="NotReadableError"||s.name==="TrackStartError")o.error(r("anticheat.cameraAccess")+" (Camera in use by another app)");else if(s.name==="OverconstrainedError")try{const n=await navigator.mediaDevices.getUserMedia({video:!0});fe(n),H("ready")}catch(n){console.error("Camera fallback failed:",n),o.error(r("anticheat.cameraAccess"))}else o.error(r("anticheat.cameraAccess"))}})(),()=>{O.current&&O.current.getTracks().forEach(s=>s.stop())}),[]);const bt=[50,100,200,500,1e3],vt=3e3,jt=250,Nt=t=>{if(!t)return!1;const s=t.getTracks();return s.length>0&&s.some(n=>n.readyState==="live")};i.useEffect(()=>{const t=()=>{if(O.current&&u.current){const a=O.current,l=u.current;if(!Nt(a)){console.warn("[Exam] Camera stream is not active, attempting to restart camera"),$e();return}l.srcObject!==a&&(console.log("[Exam] Attaching camera stream to video element"),l.srcObject=a,l.onloadeddata=()=>{console.log("[Exam] Video data loaded, readyState:",l.readyState)}),(l.paused||l.readyState<HTMLMediaElement.HAVE_CURRENT_DATA)&&l.play().catch(h=>{console.warn("Video play failed:",h),l.muted=!0,l.play().catch(()=>{})})}};t();const s=bt.map(a=>setTimeout(t,a)),n=setInterval(()=>{u.current&&O.current&&(t(),u.current.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA&&clearInterval(n))},jt),c=setTimeout(()=>{clearInterval(n)},vt);return()=>{s.forEach(a=>clearTimeout(a)),clearInterval(n),clearTimeout(c)}},[y]),i.useEffect(()=>{const t=()=>{Ve(!1),o.success(x("anticheat.networkOnline"))},s=()=>{Ve(!0),o.error(x("anticheat.networkOffline"))};window.addEventListener("online",t),window.addEventListener("offline",s);const n=m=>{const{code:d,payload:w,detectedClass:N,confidence:b,count:W}=m,B={phone:x("anticheat.phoneDetected"),material:x("anticheat.materialDetected"),headphones:x("anticheat.headphonesDetected"),person:x("anticheat.noFace")},se={lookAtScreen:x("anticheat.lookAtScreen"),NO_FACE:x("anticheat.noFace"),LOOK_RIGHT:x("anticheat.lookRight"),LOOK_LEFT:x("anticheat.lookLeft"),LOOK_DOWN:x("anticheat.lookDown"),LOOK_UP:x("anticheat.lookUp"),GAZE_LEFT:x("anticheat.gazeLeft"),GAZE_RIGHT:x("anticheat.gazeRight"),speakingDetected:x("anticheat.speakingDetected"),multiPerson:x("anticheat.multiPerson",{count:W||2}),phoneDetected:x("anticheat.phoneDetected"),materialDetected:x("anticheat.materialDetected"),headphonesDetected:x("anticheat.headphonesDetected"),monitoring:x("anticheat.monitoring"),aiLoading:x("anticheat.aiLoading"),yoloLoading:x("anticheat.yoloLoading"),basicMode:x("anticheat.basicMode"),faceOnly:x("anticheat.faceOnly"),yoloOnly:x("anticheat.yoloOnly")};return d==="detection"&&N&&B[N]?`${B[N]} (${((b||0)*100).toFixed(0)}%)`:se[d]||se[w]||w};k.current=new Worker(new URL("/assets/ai.worker-BvYAWQZO.js",import.meta.url),{type:"module"}),k.current.postMessage({type:"INIT"}),k.current.onmessage=m=>{const{type:d,payload:w,code:N}=m.data,b=n(m.data);if(d==="STATUS")Te(b);else if(d==="ALERT"){De(B=>B+1),o.warning(`${x("anticheat.aiWarning")}: ${b}`);const W=Qt.includes(N);P("ai_alert",{message:w,code:N},W)}else d==="GAZE_AWAY"&&mt(W=>W+1)},k.current.onerror=m=>{console.error("AI Worker error:",m),Te("AI Worker error - basic mode")};const c=[300,600,1e3,1500,2e3,3e3],a=200,l=()=>{var m,d,w,N;return V.current?(console.log("üé¨ Frame processing already started"),!0):!u.current||!I.current||!k.current?(console.log("üé¨ Frame processing prerequisites not met yet:",{hasVideo:!!u.current,hasCanvas:!!I.current,hasWorker:!!k.current}),!1):u.current.readyState<HTMLMediaElement.HAVE_CURRENT_DATA?(console.log("üé¨ Video not ready yet, readyState:",u.current.readyState,"(need",HTMLMediaElement.HAVE_CURRENT_DATA,"or higher)"),!1):!u.current.videoWidth||u.current.videoWidth===0?(console.log("üé¨ Video has no dimensions yet, waiting for stream..."),!1):u.current.srcObject?(console.log("üé¨ ‚úÖ Starting AI frame processing!"),console.log("   Video ready:",!!u.current,"readyState:",(m=u.current)==null?void 0:m.readyState),console.log("   Video dimensions:",(d=u.current)==null?void 0:d.videoWidth,"x",(w=u.current)==null?void 0:w.videoHeight),console.log("   Video srcObject:",!!((N=u.current)!=null&&N.srcObject)),console.log("   Canvas context ready:",!!I.current),console.log("   Worker ready:",!!k.current),V.current=setInterval(()=>{if(u.current&&k.current&&I.current&&!G.current)try{if(u.current.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA&&u.current.videoWidth>0){I.current.drawImage(u.current,0,0,640,480);const b=I.current.getImageData(0,0,640,480);b.data&&b.data.length>0?k.current.postMessage({type:"PROCESS_FRAME",payload:b},[b.data.buffer]):console.warn("üé¨ Empty image data, skipping frame")}else console.warn("üé¨ Video not ready in frame loop, readyState:",u.current.readyState,"dimensions:",u.current.videoWidth,"x",u.current.videoHeight)}catch(b){console.warn("Error sending frame to worker:",b)}},a),console.log("üé¨ Frame processing interval started (every",a,"ms)"),!0):(console.log("üé¨ Video has no srcObject, stream not attached"),!1)},h=[];let p=null;return y&&M==="ready"&&(c.forEach(m=>{const d=setTimeout(()=>{V.current||l()},m);h.push(d)}),p=setInterval(()=>{V.current?clearInterval(p):l()&&(console.log("üé¨ Frame processing started via interval check"),clearInterval(p))},400),h.push(setTimeout(()=>{var m,d,w,N;p&&clearInterval(p),V.current?console.log("üé¨ ‚úÖ Frame processing confirmed running"):(console.error("üé¨ ‚ùå CRITICAL: Frame processing failed to start after 10 seconds!"),console.error("   This means anti-cheat AI is NOT running."),console.error("   Debug info:",{examStarted:y,cameraStatus:M,hasVideo:!!u.current,hasCanvas:!!I.current,hasWorker:!!k.current,videoReadyState:(m=u.current)==null?void 0:m.readyState,videoDimensions:{width:(d=u.current)==null?void 0:d.videoWidth,height:(w=u.current)==null?void 0:w.videoHeight},hasSrcObject:!!((N=u.current)!=null&&N.srcObject)}),o.error(r("anticheat.aiNotStarted")||"H·ªá th·ªëng gi√°m s√°t AI kh√¥ng kh·ªüi ƒë·ªông ƒë∆∞·ª£c. Vui l√≤ng t·∫£i l·∫°i trang.",{autoClose:!1}))},1e4))),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",s),h.forEach(m=>clearTimeout(m)),p&&clearInterval(p),V.current&&(clearInterval(V.current),V.current=null),k.current&&k.current.terminate()}},[y,M]),i.useEffect(()=>{if(!(!y||oe===null))return ce.current=setInterval(()=>{Z(t=>t<=1?(clearInterval(ce.current),Qe(),0):(t===300&&(ct(!0),o.warning("‚ö†Ô∏è C√≤n 5 ph√∫t! H√£y ki·ªÉm tra l·∫°i b√†i l√†m.")),t===60&&o.error("‚ö†Ô∏è C√≤n 1 ph√∫t!"),t-1))},1e3),()=>clearInterval(ce.current)},[y,oe]),i.useEffect(()=>{const t=async()=>{var c;if(g==="demo"||g==="1"){Se({id:g,title:"Tr√≠ tu·ªá nh√¢n t·∫°o (AI) - B√ÄI THI M·∫™U",code:"INT3401",duration_minutes:45,require_camera:!0,require_fullscreen:!0}),ke([{id:"1",question_text:"Deep Learning l√† g√¨?",question_type:"multiple_choice",options:[{id:"A",text:"M·ªôt lo·∫°i m√°y h·ªçc d·ª±a tr√™n m·∫°ng n∆°-ron nh√¢n t·∫°o"},{id:"B",text:"M·ªôt ph·∫ßn m·ªÅm ch·ªânh s·ª≠a ·∫£nh"},{id:"C",text:"M·ªôt thu·∫≠t to√°n s·∫Øp x·∫øp"},{id:"D",text:"M·ªôt ng√¥n ng·ªØ l·∫≠p tr√¨nh"}],points:2},{id:"2",question_text:"M·∫°ng n∆°-ron t√≠ch ch·∫≠p (CNN) th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng cho lo·∫°i d·ªØ li·ªáu n√†o?",question_type:"multiple_choice",options:[{id:"A",text:"D·ªØ li·ªáu vƒÉn b·∫£n"},{id:"B",text:"D·ªØ li·ªáu √¢m thanh"},{id:"C",text:"D·ªØ li·ªáu h√¨nh ·∫£nh"},{id:"D",text:"D·ªØ li·ªáu b·∫£ng"}],points:2},{id:"3",question_text:"H√†m k√≠ch ho·∫°t ReLU c√≥ c√¥ng th·ª©c l√† g√¨?",question_type:"multiple_choice",options:[{id:"A",text:"f(x) = max(0, x)"},{id:"B",text:"f(x) = 1/(1+e^(-x))"},{id:"C",text:"f(x) = tanh(x)"},{id:"D",text:"f(x) = x^2"}],points:2},{id:"4",question_text:"Overfitting x·∫£y ra khi:",question_type:"multiple_choice",options:[{id:"A",text:"Model h·ªçc qu√° t·ªët tr√™n t·∫≠p train nh∆∞ng k√©m tr√™n t·∫≠p test"},{id:"B",text:"Model kh√¥ng h·ªçc ƒë∆∞·ª£c g√¨ t·ª´ d·ªØ li·ªáu"},{id:"C",text:"Model c√≥ qu√° √≠t tham s·ªë"},{id:"D",text:"D·ªØ li·ªáu train qu√° √≠t"}],points:2},{id:"5",question_text:"Transformer ƒë∆∞·ª£c gi·ªõi thi·ªáu trong b√†i b√°o n√†o?",question_type:"multiple_choice",options:[{id:"A",text:"Attention Is All You Need"},{id:"B",text:"ImageNet Classification with Deep CNNs"},{id:"C",text:"Playing Atari with Deep RL"},{id:"D",text:"Generative Adversarial Networks"}],points:2}]),Z(2700),Y("demo-session");return}try{const{data:a,error:l}=await v.from("exams").select(`
            *,
            class:classes(name, code)
          `).eq("id",g).single();if(l){console.error("Failed to load exam:",l),o.error(r("error.loadExam")),R("/");return}const h=new Date,p=new Date(a.start_time),m=new Date(a.end_time);if(a.status!=="published"){o.error(r("exam.notPublished")),R("/");return}if(h<p){o.error(r("exam.notStarted")),R("/");return}if(h>m){o.error(r("exam.ended")),R("/");return}Se({id:a.id,title:a.title,code:((c=a.class)==null?void 0:c.code)||"N/A",duration_minutes:a.duration_minutes,require_camera:a.require_camera,require_fullscreen:a.require_fullscreen,max_tab_violations:a.max_tab_violations,max_fullscreen_violations:a.max_fullscreen_violations});const{data:d,error:w}=await v.from("questions").select("id, question_text, question_type, options, points, order_index").eq("exam_id",g).order("order_index");if(w){console.error("Failed to load questions:",w),o.error(r("error.loadQuestions")),R("/");return}const N=a.is_shuffled?s(d):d;ke(N),Z(a.duration_minutes*60);const{data:b}=await v.from("exam_sessions").select("id, status, started_at").eq("exam_id",g).eq("student_id",_==null?void 0:_.id).eq("status","in_progress").single();if(b){Y(b.id);const W=new Date(b.started_at).getTime(),B=Date.now(),se=Math.floor((B-W)/1e3),we=Math.max(0,a.duration_minutes*60-se);if(Z(we),we===0){o.warning(r("exam.timeExpired")),Ue(!0),Qe();return}const{data:Ze}=await v.from("answers").select("question_id, student_answer, is_flagged, student_notes").eq("session_id",b.id);if(Ze){const Xe={},Je=new Set,et={};Ze.forEach(z=>{Xe[z.question_id]=z.student_answer,z.is_flagged&&Je.add(z.question_id),z.student_notes&&(et[z.question_id]=z.student_notes)}),Ce(Xe),Ae(Je),Me(et)}o.info(r("exam.sessionRestored"))}}catch(a){console.error("Error loading exam:",a),o.error(r("exam.loadError")),R("/")}},s=n=>{const c=[...n];for(let a=c.length-1;a>0;a--){const l=Math.floor(Math.random()*(a+1));[c[a],c[l]]=[c[l],c[a]]}return c};t()},[g,_,R]);const _t=async()=>{if(!f||Ee.includes(f)||_e.includes(g))return null;if(!u.current||!U.current||!I.current)return console.warn("[Evidence] Cannot capture: missing video/canvas"),null;try{const t=u.current,s=U.current,n=I.current;if(t.readyState<HTMLMediaElement.HAVE_CURRENT_DATA||!t.videoWidth)return console.warn("[Evidence] Video not ready for capture"),null;n.drawImage(t,0,0,640,480);const c=await new Promise(d=>{s.toBlob(d,"image/jpeg",Gt)});if(!c)return console.warn("[Evidence] Failed to create blob from canvas"),null;const a=new Date().toISOString().replace(/[:.]/g,"-"),l=`${f}_${a}.jpg`,{data:h,error:p}=await v.storage.from("proctoring-evidence").upload(l,c,{contentType:"image/jpeg",cacheControl:"3600",upsert:!1});if(p)return console.error("[Evidence] Upload failed:",p),null;const{data:m}=v.storage.from("proctoring-evidence").getPublicUrl(l);return console.log("[Evidence] Screenshot captured:",m.publicUrl),m.publicUrl}catch(t){return console.error("[Evidence] Capture error:",t),null}},P=async(t,s,n=!1)=>{if(f&&!(Ee.includes(f)||_e.includes(g)))try{let c=null;n&&(c=await _t()),await v.from("proctoring_logs").insert({session_id:f,event_type:t,details:s,severity:t.includes("detected")?"critical":"warning",screenshot_url:c}),c&&console.log("[Evidence] Logged with screenshot:",t)}catch(c){console.warn("Failed to log proctoring event:",(c==null?void 0:c.message)||c)}};i.useEffect(()=>{(async()=>{if(_!=null&&_.id)try{const{data:s}=await v.from("profiles").select("face_embedding").eq("id",_.id).single();s!=null&&s.face_embedding&&Oe(s.face_embedding)}catch(s){console.warn("Could not load face embedding:",s)}})()},[_==null?void 0:_.id]),i.useEffect(()=>{if(!y||!f||g==="demo"||g==="1")return;const s=180*1e3;console.log("[Face Verification] Setting up 3-minute interval checks");const n=setInterval(()=>{y&&!T&&!X&&(console.log("[Face Verification] Triggering random check (3-min interval)"),Et())},s);return()=>{clearInterval(n)}},[y,f,g,T,X]);const Et=()=>{le("random"),$(!0),P("face_verification_triggered",{type:"random"})},Ke=async t=>{if($(!1),ut(s=>s+1),f&&f!=="demo-session-id")try{await v.rpc("log_face_verification",{p_session_id:f,p_verification_type:K,p_similarity_score:t||1,p_is_match:!0})}catch(s){console.warn("Could not log face verification:",s)}o.success(r("face.success")),J&&(J(),ee(null))},Be=async(t,s)=>{if(f&&f!=="demo-session-id")try{await v.rpc("log_face_verification",{p_session_id:f,p_verification_type:K,p_similarity_score:s||0,p_is_match:!1,p_error_reason:t})}catch(n){console.warn("Could not log face verification:",n)}P("face_verification_failed",{reason:t,similarity:s,type:K}),K==="random"&&(o.warning(r("face.mismatch")),De(n=>n+1),$(!1))},Ge=async(t,s)=>{if(Oe(t),$(!1),_!=null&&_.id)try{await v.rpc("update_face_embedding",{p_embedding:t,p_image_url:s})}catch(n){console.warn("Could not save face embedding:",n)}o.success(r("face.enrollSuccess")),J&&(J(),ee(null))},St=(t,s)=>{Ce(n=>({...n,[t]:s}))},kt=t=>{Ae(s=>{const n=new Set(s);return n.has(t)?n.delete(t):n.add(t),n})},Ct=(t,s)=>{Me(n=>({...n,[t]:s}))},ge=t=>{t>=0&&t<S.length&&at(t)},At=()=>ge(F+1),Mt=()=>ge(F-1);i.useEffect(()=>{if(!y||!f||g==="demo"||g==="1")return;let s={...E},n=new Set(A),c={...L};const l=setInterval(async()=>{try{const h=S.filter(d=>{const w=E[d.id]!==s[d.id],N=A.has(d.id)!==n.has(d.id),b=L[d.id]!==c[d.id];return w||N||b});if(h.length===0)return;const p=h.map(d=>({session_id:f,question_id:d.id,student_answer:E[d.id]||null,is_flagged:A.has(d.id),student_notes:L[d.id]||null})),{error:m}=await v.from("answers").upsert(p,{onConflict:"session_id,question_id"});if(m)throw m;s={...E},n=new Set(A),c={...L}}catch(h){console.error("Auto-save error:",h)}},3e4);return()=>clearInterval(l)},[y,f,g,S,E,A,L]);const Qe=async()=>{o.warning(r("exam.timeUp")),await pe(!0)},pe=async(t=!1)=>{if(!T){if(!t){xe(!0);return}await Ye(t)}},Ye=async(t=!1)=>{xe(!1),Pe(!0),G.current=!0;try{if(_e.includes(g)||Ee.includes(f)){const n={1:"A",2:"C",3:"A",4:"A",5:"A"};let c=0,a=0;S.forEach(h=>{a+=h.points,E[h.id]===n[h.id]&&(c+=h.points)}),await new Promise(h=>setTimeout(h,500));const l=a>0?(c/a*100).toFixed(1):0;o.success(`${r("exam.submitSuccess")} ${r("exam.score")}: ${c}/${a} (${l}%)`)}else{const n=async()=>{const l=S.map(m=>({session_id:f,question_id:m.id,student_answer:E[m.id]||null,is_flagged:A.has(m.id),student_notes:L[m.id]||null})),{error:h}=await v.from("answers").upsert(l,{onConflict:"session_id,question_id"});if(h)throw console.error("Error saving answers:",h),new Error(r("exam.submitError"));const{error:p}=await v.from("exam_sessions").update({cheat_count:Ie,tab_violations:Re,fullscreen_violations:Fe,gaze_away_count:Le}).eq("id",f);p&&console.error("Error saving violations:",p);try{const{data:m,error:d}=await v.rpc("submit_exam",{p_session_id:f,p_auto_submit:t});if(d){console.warn("RPC submit_exam failed, using direct update:",d);const{error:w}=await v.from("exam_sessions").update({status:t?"auto_submitted":"submitted",submitted_at:new Date().toISOString()}).eq("id",f);if(w)throw w;return{success:!0,fallback:!0}}return m}catch(m){console.warn("RPC call failed, using fallback:",m);const{error:d}=await v.from("exam_sessions").update({status:t?"auto_submitted":"submitted",submitted_at:new Date().toISOString()}).eq("id",f);if(d)throw d;return{success:!0,fallback:!0}}},c=new Promise((l,h)=>setTimeout(()=>h(new Error(nt)),Bt)),a=await Promise.race([n(),c]);if(a&&a.percentage!==void 0){const l=a.percentage||0,h=a.passed;o.success(`${r("exam.submitSuccess")} ${r("exam.score")}: ${l.toFixed(1)}% ${h?"‚úì":"‚úó"}`)}else o.success(r("exam.submitSuccess"))}try{(document.fullscreenElement||document.webkitFullscreenElement)&&(document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen&&await document.webkitExitFullscreen())}catch(n){console.warn("Error exiting fullscreen:",n)}R("/")}catch(s){console.error("Submit error:",s),s.message===nt?o.error(r("error.timeout")):o.error(r("exam.submitError"))}finally{Pe(!1),G.current=!1}},Tt=async()=>{if(yt()){xt(!0),o.error(r("anticheat.remoteDesktop"),{autoClose:!1});return}if(!await wt())return;if(await ze(),!(g==="demo"||g==="1")&&(C==null?void 0:C.require_camera)!==!1)if(de){le("verify"),ee(()=>ye),$(!0);return}else{le("enroll"),ee(()=>ye),$(!0);return}await ye()},ye=async()=>{if(g==="demo"||g==="1")Y("demo-session-id");else if(!f&&_)try{const{data:s,error:n}=await v.rpc("start_exam_session",{p_exam_id:g,p_user_agent:navigator.userAgent,p_ip_address:null});if(n){console.error("Failed to create session:",n),n.message.includes("Maximum attempts")?o.error(r("error.general")):n.message.includes("not enrolled")?o.error(r("error.permission")):o.error(r("error.general"));return}Y(s)}catch(s){console.error("Session creation error:",s),o.error(r("error.general"));return}Ue(!0),o.info(r("common.success"))},It=t=>{const s=Math.floor(t/60),n=t%60;return`${s.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`};return y?e.jsxs("div",{className:"flex h-screen bg-background no-select",children:[e.jsx(Q,{children:X&&e.jsx(D.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 z-[100] flex items-center justify-center p-4",children:e.jsx(st,{mode:K,storedEmbedding:de,onSuccess:Ke,onFailure:Be,onEnrollComplete:Ge})})}),e.jsx(Q,{children:pt&&e.jsx(D.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 z-[200] flex items-center justify-center p-4",children:e.jsxs(D.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-paper rounded-2xl shadow-xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-warning-100 rounded-full mb-4",children:e.jsx(ie,{className:"w-8 h-8 text-warning"})}),e.jsx("h3",{className:"text-xl font-bold text-text-main",children:r("exam.submitConfirm")})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[S.filter(t=>!E[t.id]).length>0&&e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-warning-50 rounded-lg",children:[e.jsx(re,{className:"w-5 h-5 text-warning flex-shrink-0"}),e.jsxs("span",{className:"text-sm text-gray-700",children:[S.filter(t=>!E[t.id]).length," ",r("exam.unansweredWarning")]})]}),A.size>0&&e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-warning-50 rounded-lg",children:[e.jsx(ae,{className:"w-5 h-5 text-warning flex-shrink-0"}),e.jsxs("span",{className:"text-sm text-gray-700",children:[A.size," ",r("exam.flaggedWarning")]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-primary-50 rounded-lg",children:[e.jsx(be,{className:"w-5 h-5 text-primary flex-shrink-0"}),e.jsxs("span",{className:"text-sm text-gray-700",children:[r("exam.answered"),": ",Object.keys(E).length,"/",S.length]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>xe(!1),className:"flex-1 btn-secondary py-3",children:r("common.cancel")}),e.jsxs("button",{onClick:()=>Ye(!1),disabled:T,className:"flex-1 btn-success py-3",children:[T?e.jsx(ne,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(ie,{className:"w-5 h-5 mr-2"}),r("common.submit")]})]})]})})}),e.jsxs(Q,{children:[te&&e.jsx(D.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"fixed top-0 left-0 right-0 bg-danger text-white text-center font-bold z-50",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2 p-2",children:[e.jsx(rt,{className:"w-5 h-5"}),e.jsx("span",{children:r("anticheat.networkOffline")})]})}),!ht&&!T&&!Ne&&e.jsxs(D.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-black/95 z-40 flex items-center justify-center text-white flex-col",children:[e.jsx(re,{className:"w-20 h-20 text-danger mb-4 animate-bounce"}),e.jsxs("h2",{className:"text-3xl font-bold mb-4",children:["‚ö†Ô∏è ",r("anticheat.violation")]}),e.jsx("p",{className:"mb-6 text-gray-300",children:r("anticheat.returnFullscreen")}),e.jsx("button",{onClick:ze,className:"btn-danger px-8 py-3 text-lg",children:r("anticheat.fullscreenReturn")})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"bg-paper border-b border-gray-200 px-6 py-3 flex items-center justify-between flex-shrink-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-text-main",children:C==null?void 0:C.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:[r("exam.code"),": ",C==null?void 0:C.code]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:`flex items-center space-x-1 text-sm ${te?"text-danger":"text-success"}`,children:[te?e.jsx(rt,{className:"w-4 h-4"}):e.jsx($t,{className:"w-4 h-4"}),e.jsx("span",{children:te?"Offline":"Online"})]}),e.jsxs("div",{className:`flex items-center space-x-2 px-4 py-2 rounded-lg font-mono text-lg font-bold ${it?"bg-danger-100 text-danger animate-pulse":"bg-primary-50 text-primary"}`,children:[e.jsx(Ot,{className:"w-5 h-5"}),e.jsx("span",{children:It(oe||0)})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:j&&e.jsxs(D.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-10 h-10 bg-primary text-white font-bold rounded-full",children:F+1}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["C√¢u ",F+1,"/",S.length]}),e.jsxs("span",{className:"text-sm text-gray-400 ml-2",children:["(",j.points," ƒëi·ªÉm)"]})]})]}),e.jsx("button",{onClick:()=>kt(j.id),className:`flex items-center space-x-1 px-3 py-1.5 rounded-lg transition-colors ${A.has(j.id)?"bg-warning-100 text-warning-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:A.has(j.id)?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"ƒê√£ g·∫Øn c·ªù"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Pt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"G·∫Øn c·ªù"})]})})]}),e.jsxs("div",{className:"card mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-main mb-6",children:j.question_text}),e.jsx("div",{className:"space-y-3",children:j.options.map(t=>e.jsxs("label",{className:`flex items-center p-4 border-2 rounded-xl cursor-pointer transition-all ${E[j.id]===t.id?"border-primary bg-primary-50":"border-gray-200 hover:border-primary-300 hover:bg-gray-50"}`,children:[e.jsx("input",{type:"radio",name:`question-${j.id}`,value:t.id,checked:E[j.id]===t.id,onChange:()=>St(j.id,t.id),className:"sr-only"}),e.jsx("div",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center mr-4 flex-shrink-0 ${E[j.id]===t.id?"border-primary bg-primary text-white":"border-gray-300"}`,children:e.jsx("span",{className:"font-semibold",children:t.id})}),e.jsx("span",{className:"text-gray-700",children:t.text})]},t.id))})]}),e.jsxs("div",{className:"card",children:[e.jsxs("button",{onClick:()=>ft(!We),className:"flex items-center space-x-2 text-gray-600 hover:text-primary transition-colors",children:[e.jsx(zt,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Ghi ch√∫ nh√°p"}),L[j.id]&&e.jsx("span",{className:"w-2 h-2 bg-primary rounded-full"})]}),e.jsx(Q,{children:We&&e.jsx(D.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("textarea",{placeholder:"Ghi ch√∫ c√° nh√¢n cho c√¢u h·ªèi n√†y... (ch·ªâ b·∫°n th·∫•y)",value:L[j.id]||"",onChange:t=>Ct(j.id,t.target.value),className:"w-full mt-3 p-3 border border-gray-200 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-primary-500",rows:3})})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("button",{onClick:Mt,disabled:F===0,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ut,{className:"w-5 h-5 mr-1"}),r("common.previous")]}),F===S.length-1?e.jsxs("button",{onClick:()=>pe(!1),disabled:T,className:"btn-success",children:[T?e.jsx(ne,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(ie,{className:"w-5 h-5 mr-2"}),r("common.submit")]}):e.jsxs("button",{onClick:At,className:"btn-primary",children:[r("common.next"),e.jsx(Vt,{className:"w-5 h-5 ml-1"})]})]})]},j.id)})]}),e.jsxs("div",{className:"w-80 bg-paper border-l border-gray-200 flex flex-col flex-shrink-0",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"font-bold text-gray-700 flex items-center space-x-2",children:[e.jsx(je,{className:"w-4 h-4"}),e.jsx("span",{children:r("proctoring.camera")})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-danger rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs text-danger font-bold",children:r("proctoring.recording")})]})]}),e.jsx("div",{className:"relative bg-gray-900 rounded-lg overflow-hidden aspect-video",children:e.jsx("video",{ref:u,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"})}),e.jsx("p",{className:"text-xs mt-2 text-gray-500 text-center",children:ot||r("common.loading")})]}),e.jsxs("div",{className:"p-4 border-b border-gray-200 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 bg-danger-50 rounded-lg",children:[e.jsx("span",{className:"text-xs text-gray-600",children:r("proctoring.aiDetection")}),e.jsx("span",{className:"font-bold text-danger",children:Ie})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-warning-50 rounded-lg",children:[e.jsx("span",{className:"text-xs text-gray-600",children:r("proctoring.tabViolations")}),e.jsx("span",{className:"font-bold text-warning",children:Re})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-warning-50 rounded-lg",children:[e.jsx("span",{className:"text-xs text-gray-600",children:r("proctoring.fullscreenViolations")}),e.jsx("span",{className:"font-bold text-warning",children:Fe})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-xs text-gray-600",children:r("proctoring.gazeAway")}),e.jsx("span",{className:"font-bold text-gray-600",children:Le})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-bold text-gray-700",children:r("proctoring.questionList")}),e.jsx("button",{onClick:()=>gt(!he),className:"text-gray-400 hover:text-gray-600",children:he?e.jsx(qt,{className:"w-4 h-4"}):e.jsx(Ht,{className:"w-4 h-4"})})]}),he&&e.jsx("div",{className:"grid grid-cols-5 gap-2",children:S.map((t,s)=>{const n=!!E[t.id],c=A.has(t.id),a=s===F;return e.jsxs("button",{onClick:()=>ge(s),className:`relative w-10 h-10 rounded-lg font-medium text-sm transition-all ${a?"bg-primary text-white ring-2 ring-primary ring-offset-2":n?"bg-success-100 text-success-700 hover:bg-success-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[s+1,c&&e.jsx(ae,{className:"absolute -top-1 -right-1 w-3 h-3 text-warning fill-warning"})]},t.id)})}),e.jsxs("div",{className:"mt-4 space-y-1 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-success-100 rounded"}),e.jsx("span",{children:r("proctoring.answered")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-100 rounded"}),e.jsx("span",{children:r("proctoring.unanswered")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{className:"w-4 h-4 text-warning fill-warning"}),e.jsx("span",{children:r("proctoring.flagged")})]})]})]}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("button",{onClick:()=>pe(!1),disabled:T,className:"btn-success w-full py-3",children:[T?e.jsx(ne,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(ie,{className:"w-5 h-5 mr-2"}),r("common.submit")," (",Object.keys(E).length,"/",S.length,")"]})})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gradient-to-br from-primary-50 to-background p-4",children:[e.jsxs(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-paper p-8 rounded-2xl shadow-soft max-w-lg w-full",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-primary-100 rounded-full mb-4",children:e.jsx(tt,{className:"w-8 h-8 text-primary"})}),e.jsx("h2",{className:"text-2xl font-bold text-text-main",children:r("exam.rules.title")}),e.jsx("p",{className:"text-gray-500 mt-1",children:(C==null?void 0:C.title)||r("common.loading")})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-success-50 rounded-lg",children:[e.jsx(be,{className:"w-5 h-5 text-success mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700",children:r("exam.rules.camera")})]}),e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-success-50 rounded-lg",children:[e.jsx(be,{className:"w-5 h-5 text-success mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700",children:r("exam.rules.fullscreen")})]}),e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-danger-50 rounded-lg",children:[e.jsx(ve,{className:"w-5 h-5 text-danger mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700",children:r("exam.rules.noMultiScreen")})]}),e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-danger-50 rounded-lg",children:[e.jsx(ve,{className:"w-5 h-5 text-danger mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700",children:r("exam.rules.noTabSwitch")})]}),e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-danger-50 rounded-lg",children:[e.jsx(ve,{className:"w-5 h-5 text-danger mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700",children:r("exam.rules.noRemoteDesktop")})]})]}),qe&&e.jsxs("div",{className:"p-4 bg-danger-100 border border-danger-200 rounded-lg mb-4 flex items-center space-x-3",children:[e.jsx(Wt,{className:"w-6 h-6 text-danger"}),e.jsx("span",{className:"text-sm font-bold text-danger",children:r("anticheat.multiScreen")})]}),He&&e.jsxs("div",{className:"p-4 bg-danger-100 border border-danger-200 rounded-lg mb-4 flex items-center space-x-3",children:[e.jsx(re,{className:"w-6 h-6 text-danger"}),e.jsx("span",{className:"text-sm font-bold text-danger",children:r("anticheat.remoteDesktop")})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:r("exam.rules.cameraCheck")}),e.jsxs("div",{className:"relative bg-gray-900 rounded-lg overflow-hidden aspect-video",children:[M==="loading"&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center flex-col",children:[e.jsx(ne,{className:"w-8 h-8 text-white animate-spin mb-2"}),e.jsx("p",{className:"text-white text-sm",children:r("common.loading")})]}),M==="error"&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center flex-col p-4",children:[e.jsx(re,{className:"w-12 h-12 text-danger mb-2"}),e.jsx("p",{className:"text-white text-sm text-center mb-3",children:r("anticheat.cameraAccess")}),e.jsxs("button",{onClick:$e,className:"flex items-center space-x-2 bg-primary hover:bg-primary-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors",children:[e.jsx(je,{className:"w-4 h-4"}),e.jsx("span",{children:r("face.retake")})]})]}),e.jsx("video",{ref:u,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute bottom-2 left-2 flex items-center space-x-1 bg-black/50 text-white text-xs px-2 py-1 rounded",children:[e.jsx(je,{className:"w-3 h-3"}),e.jsx("span",{children:r("proctoring.camera")}),M==="ready"&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 ml-1 animate-pulse"}),M==="error"&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500 ml-1"})]})]}),M==="error"&&e.jsxs("p",{className:"text-xs text-danger mt-2 text-center",children:[r("anticheat.cameraAccess")," - ",r("exam.rules.camera")]})]}),e.jsxs("button",{onClick:Tt,disabled:qe||He||M!=="ready",className:"btn-primary w-full py-3 text-lg disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(tt,{className:"w-5 h-5 mr-2"}),r("exam.rules.agree")]}),M!=="ready"&&e.jsxs("p",{className:"text-xs text-center text-gray-500 mt-2",children:[r("exam.rules.cameraCheck")," ",M==="loading"?"...":""]})]}),e.jsx(Q,{children:X&&e.jsx(D.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4",children:e.jsx(st,{mode:K,storedEmbedding:de,onSuccess:Ke,onFailure:Be,onEnrollComplete:Ge})})})]})}export{rs as default};
