import{c as C,u as U,a as V,b as z,r as g,j as e,s as y,B as b}from"./index-xao09O-H.js";import{F as E,L as B}from"./LanguageSwitcher-Kes7wNMw.js";import{L as O,U as R,m as f}from"./proxy-B6zqYPpf.js";import{L as G}from"./log-out-B4qGzG7x.js";import{C as _,a as H}from"./clock-C_M3QZ45.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=C("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x=C("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);function Z(){var v;const{user:r,profile:n,profileLoading:j,logout:L}=U(),{t:s}=V(),u=z(),[p,N]=g.useState([]),[T,h]=g.useState(!0);g.useEffect(()=>{(async()=>{var m,l,c;if(j)return;const a=(n==null?void 0:n.role)==="instructor"||(n==null?void 0:n.role)==="admin"||((m=r==null?void 0:r.user_metadata)==null?void 0:m.role)==="instructor"||((l=r==null?void 0:r.user_metadata)==null?void 0:l.role)==="admin";if(!r||a){h(!1);return}try{const{data:i,error:o}=await y.from("enrollments").select("class_id").eq("student_id",r.id).eq("status","active");if(o)throw o;if(!i||i.length===0){N([]),h(!1);return}const q=i.map(d=>d.class_id),{data:$,error:k}=await y.from("exams").select(`
            *,
            class:classes(name, code)
          `).in("class_id",q).eq("status","published").order("start_time",{ascending:!0});if(k)throw k;const{data:F}=await y.from("exam_sessions").select("exam_id, status, percentage").eq("student_id",r.id),M=new Map((F||[]).map(d=>[d.exam_id,d])),P=($||[]).map(d=>({...d,session:M.get(d.id)||null}));N(P)}catch(i){console.error("Load exams error:",i);const o=((c=i.message)==null?void 0:c.toLowerCase())||"";o.includes("network")||o.includes("fetch")?b.error(s("error.network")):o.includes("permission")||o.includes("unauthorized")?b.error(s("error.sessionExpired")):b.error(s("error.loadExams"))}finally{h(!1)}})()},[r,n,j,s]);const D=async()=>{await L(),u("/login")},S=t=>{var c,i;const a=new Date,m=new Date(t.start_time),l=new Date(t.end_time);return((c=t.session)==null?void 0:c.status)==="submitted"||((i=t.session)==null?void 0:i.status)==="auto_submitted"?{type:"completed",label:s("exam.status.completed"),color:"bg-success-100 text-success-700",icon:H,canTake:!1}:a<m?{type:"upcoming",label:s("exam.status.upcoming"),color:"bg-gray-100 text-gray-600",icon:_,canTake:!1}:a>l?{type:"ended",label:s("exam.status.ended"),color:"bg-gray-100 text-gray-500",icon:J,canTake:!1}:{type:"active",label:s("exam.status.active"),color:"bg-primary-100 text-primary-700",icon:x,canTake:!0}},A=t=>new Date(t).toLocaleString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),I={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},w={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}};return T?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(O,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs("div",{className:"min-h-screen bg-background font-sans text-text-main",children:[e.jsxs("nav",{className:"bg-paper shadow-sm border-b border-gray-200 px-8 py-4 flex justify-between items-center sticky top-0 z-10",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"bg-primary p-2 rounded-lg",children:e.jsx(E,{className:"text-white w-6 h-6"})}),e.jsxs("span",{className:"text-xl font-bold text-text-main tracking-tight",children:["SmartExam",e.jsx("span",{className:"text-primary",children:"Pro"})]})]}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx(B,{compact:!0}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm font-medium text-gray-600 bg-gray-100 px-3 py-1.5 rounded-full",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{children:(n==null?void 0:n.full_name)||(r==null?void 0:r.email)})]}),e.jsxs("button",{onClick:D,className:"flex items-center space-x-2 text-danger hover:bg-danger-50 px-4 py-2 rounded-lg transition-colors text-sm font-semibold",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:s("auth.logout")})]})]})]}),e.jsxs(f.div,{variants:I,initial:"hidden",animate:"visible",className:"max-w-6xl mx-auto px-8 py-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-text-main",children:[s("dashboard.hello"),", ",((v=n==null?void 0:n.full_name)==null?void 0:v.split(" ").pop())||s("auth.student"),"! ðŸ‘‹"]}),e.jsx("p",{className:"text-gray-500 mt-2",children:s("dashboard.selectExam")})]}),p.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.map(t=>{var l,c,i;const a=S(t),m=a.icon;return e.jsxs(f.div,{variants:w,className:`card hover:shadow-soft transition-all group ${a.canTake?"":"opacity-75"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider ${a.color}`,children:a.label}),e.jsx(m,{className:`w-5 h-5 ${a.type==="active"?"text-primary":a.type==="completed"?"text-success":"text-gray-400"}`})]}),e.jsx("h3",{className:`text-xl font-bold mb-2 ${a.canTake?"text-text-main group-hover:text-primary":"text-gray-700"} transition-colors`,children:t.title}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-500 mb-4",children:[e.jsxs("p",{children:[s("exam.course"),": ",((l=t.class)==null?void 0:l.name)||"N/A"]}),e.jsxs("p",{children:[s("exam.code"),": ",((c=t.class)==null?void 0:c.code)||"N/A"]}),e.jsxs("p",{className:"flex items-center space-x-1",children:[e.jsx(_,{className:"w-4 h-4"}),e.jsxs("span",{children:[s("exam.duration"),": ",t.duration_minutes," ",s("exam.minutes")]})]})]}),a.type==="completed"&&((i=t.session)==null?void 0:i.percentage)!==null&&e.jsx("div",{className:"mb-4 p-3 bg-success-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[s("exam.score"),": ",e.jsxs("span",{className:"font-bold text-success-700",children:[t.session.percentage.toFixed(1),"%"]})]})}),a.type==="upcoming"&&e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg text-xs text-gray-500",children:e.jsxs("p",{children:[s("exam.startTime"),": ",A(t.start_time)]})}),a.canTake?e.jsxs("button",{onClick:()=>u(`/exam/${t.id}`),className:"w-full flex items-center justify-center space-x-2 btn-primary py-3",children:[e.jsx(x,{className:"w-5 h-5"}),e.jsx("span",{children:s("dashboard.enterExam")})]}):a.type==="completed"&&t.allow_review?e.jsx("button",{className:"w-full btn-secondary py-3",children:s("dashboard.reviewExam")}):e.jsx("button",{disabled:!0,className:"w-full bg-gray-200 text-gray-500 py-3 rounded-xl font-semibold cursor-not-allowed",children:a.type==="upcoming"?s("dashboard.notStarted"):a.type==="ended"?s("dashboard.expired"):s("dashboard.notAvailable")})]},t.id)})}):e.jsxs("div",{className:"text-center py-16 bg-paper rounded-2xl border border-gray-100",children:[e.jsx(E,{className:"w-20 h-20 mx-auto mb-4 text-gray-300"}),e.jsx("h2",{className:"text-xl font-bold text-gray-700 mb-2",children:s("dashboard.noExams")}),e.jsx("p",{className:"text-gray-500",children:s("dashboard.noExamsDesc")})]}),p.length===0&&e.jsxs("div",{className:"mt-8",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:s("dashboard.demoExam")}),e.jsxs(f.div,{variants:w,className:"card hover:shadow-soft transition-all group max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"bg-primary-100 text-primary-700 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider",children:"Demo"}),e.jsx(x,{className:"w-5 h-5 text-primary"})]}),e.jsx("h3",{className:"text-xl font-bold text-text-main mb-2 group-hover:text-primary transition-colors",children:"TrÃ­ tuá»‡ nhÃ¢n táº¡o (AI)"}),e.jsxs("p",{className:"text-gray-500 text-sm mb-6",children:[s("exam.code"),": INT3401 â€¢ ",s("exam.duration"),": 45 ",s("exam.minutes")]}),e.jsxs("button",{onClick:()=>u("/exam/demo"),className:"w-full flex items-center justify-center space-x-2 btn-primary py-3",children:[e.jsx(x,{className:"w-5 h-5"}),e.jsx("span",{children:s("dashboard.enterExam")})]})]})]})]})]})}export{Z as default};
